<!doctype html><!-- This site was created with Wowchemy. https://www.wowchemy.com --><!-- Last Published: February 26, 2023 --><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.7.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><link rel=stylesheet href=/css/vendor-bundle.min.16f785cdb553c8c4431db6775122af35.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/academicons@1.9.2/css/academicons.min.css integrity="sha512-KlJCpRsLf+KKu2VQa5vmRuClRFjxc5lXO03ixZt82HZUk41+1I0bD8KBSA0fY290ayMfWYI9udIqeOWSu1/uZg==" crossorigin=anonymous media=print onload='this.media="all"'><link rel=stylesheet href=/css/wowchemy.242b882c3b0c00ae28b251add3931eef.css><link rel=stylesheet href=/css/libs/chroma/github-light.min.css title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=/css/libs/chroma/dracula.min.css title=hl-dark media=print onload='this.media="all"' disabled><script async src="https://www.googletagmanager.com/gtag/js?id=G-NNZHY5233M"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}function trackOutboundLink(e,t){gtag("event","click",{event_category:"outbound",event_label:e,transport_type:"beacon",event_callback:function(){t!=="_blank"&&(document.location=e)}}),console.debug("Outbound link clicked: "+e)}function onClickCallback(e){if(e.target.tagName!=="A"||e.target.host===window.location.host)return;trackOutboundLink(e.target,e.target.getAttribute("target"))}gtag("js",new Date),gtag("config","G-NNZHY5233M",{}),gtag("set",{cookie_flags:"SameSite=None;Secure"}),document.addEventListener("click",onClickCallback,!1)</script><meta name=author content="Giovanni Pecoraro"><meta name=description content="Domain enumeration is the process of extracting information from the Active Directory like enumerating the users, groups, and other interesting fields and resources."><link rel=alternate hreflang=en-us href=https://www.peco602.com/post/0000-domain-enumeration-cheatsheet/><link rel=canonical href=https://www.peco602.com/post/0000-domain-enumeration-cheatsheet/><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_180x180_fill_lanczos_center_3.png><meta name=theme-color content="#3f51b5"><meta property="twitter:card" content="summary"><meta property="twitter:site" content="@Peco602"><meta property="twitter:creator" content="@Peco602"><meta property="twitter:image" content="https://www.peco602.com/media/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_512x512_fill_lanczos_center_3.png"><meta property="og:site_name" content="Giovanni Pecoraro"><meta property="og:url" content="https://www.peco602.com/post/0000-domain-enumeration-cheatsheet/"><meta property="og:title" content="Domain Enumeration cheatsheet | Giovanni Pecoraro"><meta property="og:description" content="Domain enumeration is the process of extracting information from the Active Directory like enumerating the users, groups, and other interesting fields and resources."><meta property="og:image" content="https://www.peco602.com/media/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_512x512_fill_lanczos_center_3.png"><meta property="og:locale" content="en-us"><meta property="article:published_time" content="2022-07-17T00:00:00+00:00"><meta property="article:modified_time" content="2022-07-17T00:00:00+00:00"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.peco602.com/post/0000-domain-enumeration-cheatsheet/"},"headline":"Domain Enumeration cheatsheet","datePublished":"2022-07-17T00:00:00Z","dateModified":"2022-07-17T00:00:00Z","author":{"@type":"Person","name":"Giovanni Pecoraro"},"publisher":{"@type":"Organization","name":"Giovanni Pecoraro","logo":{"@type":"ImageObject","url":"https://www.peco602.com/media/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_192x192_fill_lanczos_center_3.png"}},"description":"Domain enumeration is the process of extracting information from the Active Directory like enumerating the users, groups, and other interesting fields and resources."}</script><title>Domain Enumeration cheatsheet | Giovanni Pecoraro</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=bebede30aad4cefc8f1f1c17ce5ead08><script src=/js/wowchemy-init.min.7532de8e15162845d694f17af8b46a99.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class=col-6><h1>Search</h1></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=Close><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box><input name=q id=search-query placeholder=Search... autocapitalize=off autocomplete=off autocorrect=off spellcheck=false type=search class=form-control aria-label=Search...></div></section><section class=section-search-results><div id=search-hits></div></section></div></aside><div class="page-header header--fixed"><header><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Giovanni Pecoraro</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Giovanni Pecoraro</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/#about><span>Home</span></a></li><li class=nav-item><a class=nav-link href=/#posts><span>Posts</span></a></li><li class=nav-item><a class=nav-link href=/#projects><span>Projects</span></a></li><li class=nav-item><a class=nav-link href=/#talks><span>Talks</span></a></li><li class=nav-item><a class=nav-link href=/#featured><span>Publications</span></a></li><li class=nav-item><a class=nav-link href=/#contact><span>Contact</span></a></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class="nav-item d-none d-lg-inline-flex"><a class=nav-link href=https://twitter.com/Peco602 data-toggle=tooltip data-placement=bottom title="Follow me on Twitter" target=_blank rel=noopener aria-label="Follow me on Twitter"><i class="fab fa-twitter" aria-hidden=true></i></a></li><li class=nav-item><a class="nav-link js-search" href=# aria-label=Search><i class="fas fa-search" aria-hidden=true></i></a></li><li class="nav-item dropdown theme-dropdown"><a href=# class=nav-link data-toggle=dropdown aria-haspopup=true aria-label="Display preferences"><i class="fas fa-moon" aria-hidden=true></i></a><div class=dropdown-menu><a href=# class="dropdown-item js-set-theme-light"><span>Light</span></a>
<a href=# class="dropdown-item js-set-theme-dark"><span>Dark</span></a>
<a href=# class="dropdown-item js-set-theme-auto"><span>Automatic</span></a></div></li></ul></div></nav></header></div><div class=page-body><article class=article><div class="article-container pt-3"><h1>Domain Enumeration cheatsheet</h1><p class=page-subtitle>Domain enumeration is the process of extracting information from the Active Directory like enumerating the users, groups, and other interesting fields and resources.</p><div class=article-metadata><div><span class=author-highlighted>Giovanni Pecoraro</span></div><span class=article-date>Jul 17, 2022</span>
<span class=middot-divider></span>
<span class=article-reading-time>12 min read</span>
<span class=middot-divider></span>
<span class=article-categories><i class="fas fa-folder mr-1"></i><a href=/category/cyber-security/>Cyber Security</a></span></div></div><div class=article-container><div class=article-style><h2 id=module-import>Module Import</h2><p>Load the PowerView module:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>powershell</span> <span class=n>-ep</span> <span class=n>bypass</span>
</span></span><span class=line><span class=cl><span class=p>.</span> <span class=p>.\</span><span class=n>PowerView</span><span class=p>.</span><span class=py>ps1</span>
</span></span></code></pre></div><p>or the ActiveDirectory module (to use ActiveDirectory module without installing RSAT, we can use <code>Import-Module</code> for the valid Active Directory module DLL):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Import-Module</span> <span class=p>.\</span><span class=n>Microsoft</span><span class=p>.</span><span class=py>ActiveDirectory</span><span class=p>.</span><span class=py>Management</span><span class=p>.</span><span class=py>dll</span>
</span></span><span class=line><span class=cl><span class=nb>Import-Module</span> <span class=p>.\</span><span class=n>ActiveDirectory</span><span class=p>\</span><span class=n>ActiveDirectory</span><span class=p>.</span><span class=py>psd1</span>
</span></span></code></pre></div><p>It works also in case of ConstrainedLanguage Mode:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nv>$ExecutionContext</span><span class=p>.</span><span class=py>SessionState</span><span class=p>.</span><span class=py>LanguageMode</span>
</span></span></code></pre></div><h2 id=basic-enumeration>Basic Enumeration</h2><p>Get current domain or trusted domain objects:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetDomain</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetDomain</span> <span class=n>-Domain</span> <span class=s2>&#34;cyberlab.cybercorp.local&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetDomain</span> <span class=n>-Domain</span> <span class=s2>&#34;cybercorp.local&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>## Test it via getting domain NetBios name</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=nb>gwmi </span><span class=n>Win32_NTDomain</span><span class=p>).</span><span class=py>DomainName</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># ActiveDirectory Module</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ADDomain</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ADDomain</span> <span class=n>-Identiy</span> <span class=s2>&#34;cyberlab.cybercorp.local&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ADDomain</span> <span class=n>-Identiy</span> <span class=s2>&#34;cybercorp.local&#34;</span>
</span></span></code></pre></div><p>Get domain SID for the current domain:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Get-DomainSID</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># ActiveDirectory Module</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=nb>Get-ADDomain</span><span class=p>).</span><span class=py>DomainSID</span>
</span></span></code></pre></div><p>Get domain policy for the current domain or for a trusted domain:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Get-DomainPolicy</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=nb>Get-DomainPolicy</span><span class=p>).</span><span class=s2>&#34;System Access&#34;</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=nb>Get-DomainPolicy</span><span class=p>).</span><span class=s2>&#34;Kerberos Policy&#34;</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=nb>Get-DomainPolicy</span> <span class=n>-Domain</span> <span class=s2>&#34;cybercorp.local&#34;</span><span class=p>).</span><span class=s2>&#34;System Access&#34;</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=nb>Get-DomainPolicy</span> <span class=n>-Domain</span> <span class=s2>&#34;cybercorp.local&#34;</span><span class=p>).</span><span class=s2>&#34;Kerberos Policy&#34;</span>
</span></span></code></pre></div><p>Get Domain Controllers for the current or for a trusted domain:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetDomainController</span>						
</span></span><span class=line><span class=cl><span class=nb>Get-NetDomainController</span>	<span class=n>-Domain</span> <span class=s2>&#34;cybercorp.local&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># ActiveDirectory Module</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ADDomainController</span>						
</span></span><span class=line><span class=cl><span class=nb>Get-ADDomainController</span> <span class=n>-DomainName</span> <span class=s2>&#34;cybercorp.local&#34;</span> <span class=n>-Discover</span>
</span></span></code></pre></div><p>Get the list of users in the current domain:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetUser</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetUser</span> <span class=p>|</span> <span class=nb>select </span><span class=n>-ExpandProperty</span> <span class=n>samaccountname</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetUser</span> <span class=p>|</span> <span class=nb>select </span><span class=n>samaccountname</span><span class=p>,</span><span class=n>title</span><span class=p>,</span><span class=n>description</span><span class=p>,</span><span class=n>logoncount</span><span class=p>,</span><span class=n>pwdlastset</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetUser</span> <span class=n>-Domain</span> <span class=s2>&#34;cybercorp.local&#34;</span> <span class=p>|</span> <span class=nb>select </span><span class=n>-ExpandProperty</span> <span class=n>samaccountname</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetUser</span> <span class=n>-UserName</span> <span class=s2>&#34;STUDENT1&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># ActiveDirectory Module</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ADUser</span> <span class=n>-Filter</span> <span class=p>*</span> <span class=n>-Properties</span> <span class=p>*</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ADUser</span> <span class=n>-Identity</span> <span class=s2>&#34;STUDENT1&#34;</span> <span class=n>-Properties</span> <span class=p>*</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-batch data-lang=batch><span class=line><span class=cl><span class=p>:</span><span class=c1>:cmd.exe</span>
</span></span><span class=line><span class=cl>net user /domain
</span></span><span class=line><span class=cl>net user <span class=s2>&#34;STUDENT1&#34;</span> /domain
</span></span></code></pre></div><p>Get list of all properties for users in the current domain:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Get-UserProperty</span>					<span class=c># All properties</span>
</span></span><span class=line><span class=cl><span class=nb>Get-UserProperty</span> <span class=n>-Properties</span> <span class=s2>&#34;pwdlastset&#34;</span>		<span class=c># Only pwdlastset property</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># ActiveDirectory Module</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ADUser</span> <span class=n>-Filter</span> <span class=p>*</span> <span class=n>-Properties</span> <span class=p>*</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ADUser</span> <span class=n>-Identity</span> <span class=s2>&#34;STUDENT1&#34;</span> <span class=n>-Properties</span> <span class=p>*</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ADUser</span> <span class=n>-Filter</span> <span class=p>*</span> <span class=n>-Properties</span> <span class=p>*</span> <span class=p>|</span> <span class=nb>select </span><span class=n>-First</span> <span class=mf>1</span> <span class=p>|</span> <span class=nb>Get-Member</span> <span class=n>-MemberType</span> <span class=n>Property</span> <span class=p>|</span> <span class=nb>select </span><span class=n>Name</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ADUser</span> <span class=n>-Filter</span> <span class=p>*</span> <span class=n>-Properties</span> <span class=p>*</span> <span class=p>|</span> <span class=nb>select </span><span class=n>name</span><span class=p>,</span><span class=vm>@</span><span class=p>{</span><span class=n>expression</span><span class=p>={[</span><span class=no>datetime</span><span class=p>]::</span><span class=n>fromFileTime</span><span class=p>(</span><span class=nv>$_</span><span class=p>.</span><span class=n>pwdlastset</span><span class=p>)}}</span>	
</span></span></code></pre></div><p>Search for a particular string in a users&rsquo; attribute:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Find-UserField</span> <span class=n>-Verbose</span>
</span></span><span class=line><span class=cl><span class=nb>Find-UserField</span> <span class=n>-SearchField</span> <span class=s2>&#34;Description&#34;</span> <span class=n>-SearchTerm</span> <span class=s2>&#34;built&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># ActiveDirectory Module</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ADUser</span> <span class=n>-Filter</span> <span class=s1>&#39;Description -like &#34;*built*&#34;&#39;</span> <span class=n>-Properties</span> <span class=n>Description</span> <span class=p>|</span> <span class=nb>select </span><span class=n>Name</span><span class=p>,</span><span class=n>Description</span>
</span></span></code></pre></div><p>Get a list of computers in the current domain:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetComputer</span> 
</span></span><span class=line><span class=cl><span class=nb>Get-NetComputer</span> <span class=n>-OperatingSystem</span> <span class=s2>&#34;*Server 2016*&#34;</span> 
</span></span><span class=line><span class=cl><span class=nb>Get-NetComputer</span> <span class=n>-Ping</span> 
</span></span><span class=line><span class=cl><span class=nb>Get-NetComputer</span> <span class=n>-FullData</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>## Get computer IPs</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetComputer</span> <span class=p>|</span> <span class=p>%</span> <span class=p>{</span><span class=nv>$name</span><span class=p>=</span><span class=nv>$_</span><span class=p>;</span> <span class=nv>$ip</span><span class=p>=[</span><span class=no>System.Net.Dns</span><span class=p>]::</span><span class=n>GetHostAddresses</span><span class=p>(</span><span class=nv>$name</span><span class=p>).</span><span class=n>IPAddressToString</span><span class=p>;</span> <span class=nb>Write-Host</span> <span class=nv>$name</span> <span class=s2>&#34;</span><span class=se>`t</span><span class=s2> : &#34;</span> <span class=nv>$ip</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># ActiveDirectory Module</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ADComputer</span> <span class=n>-Filter</span> <span class=p>*</span> <span class=p>|</span> <span class=nb>select </span><span class=n>Name</span> 
</span></span><span class=line><span class=cl><span class=nb>Get-ADComputer</span> <span class=n>-Filter</span> <span class=s1>&#39;OperatingSystem -like &#34;*Server 2016*&#34;&#39;</span> <span class=n>-Properties</span> <span class=n>OperatingSystem</span> <span class=p>|</span> <span class=nb>select </span><span class=n>Name</span><span class=p>,</span><span class=n>OperatingSystem</span> 
</span></span><span class=line><span class=cl><span class=nb>Get-ADComputer</span> <span class=n>-Filter</span> <span class=p>*</span> <span class=n>-Properties</span> <span class=n>DNSHostName</span> <span class=p>|</span> <span class=p>%{</span><span class=nb>Test-Connection</span> <span class=n>-Count</span> <span class=mf>1</span> <span class=n>-ComputerName</span> <span class=nv>$_</span><span class=p>.</span><span class=n>DNSHostName</span><span class=p>}</span> 	
</span></span><span class=line><span class=cl><span class=nb>Get-ADComputer</span> <span class=n>-Filter</span> <span class=p>*</span> <span class=n>-Properties</span> <span class=p>*</span> 
</span></span></code></pre></div><p>Search for a particular string in a computer attribute:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Find-ComputerField</span> <span class=n>-SearchField</span> <span class=s2>&#34;OperatingSystem&#34;</span> <span class=n>-SearchTerm</span> <span class=s2>&#34;windows&#34;</span>	
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># ActiveDirectory Module</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ADComputer</span> <span class=n>-Filter</span> <span class=s1>&#39;Description -like &#34;*built*&#34;&#39;</span> <span class=n>-Properties</span> <span class=n>Description</span> <span class=p>|</span> <span class=nb>select </span><span class=n>name</span><span class=p>,</span><span class=n>Description</span>
</span></span></code></pre></div><p>Get groups in the current domain:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetGroup</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetGroup</span> <span class=n>-GroupName</span> <span class=s2>&#34;Domain Admins&#34;</span> <span class=n>-FullData</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetGroup</span> <span class=n>-GroupName</span> <span class=s2>&#34;Enterprise Admins&#34;</span> <span class=n>-FullData</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetGroup</span> <span class=n>-GroupName</span> <span class=s2>&#34;*admin*&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># ActiveDirectory Module</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ADGroup</span> <span class=n>-Filter</span> <span class=p>*</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ADGroup</span> <span class=n>-Filter</span> <span class=s1>&#39;Name -like &#34;*admin*&#34;&#39;</span> <span class=p>|</span> <span class=nb>select </span><span class=n>Name</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-batch data-lang=batch><span class=line><span class=cl><span class=p>:</span><span class=c1>:cmd.exe</span>
</span></span><span class=line><span class=cl>net group /domain 
</span></span><span class=line><span class=cl>net group <span class=s2>&#34;Domain Admins&#34;</span> /domain 
</span></span></code></pre></div><p>Get all the members of a group:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetGroupMember</span> <span class=n>-GroupName</span> <span class=s2>&#34;Domain Admins&#34;</span> <span class=n>-Recurse</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetGroupMember</span> <span class=n>-GroupName</span> <span class=s2>&#34;Enterprise Admins&#34;</span> <span class=n>-Recurse</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># ActiveDirectory Module</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ADGroupMember</span> <span class=n>-Identity</span> <span class=s2>&#34;Domain Admins&#34;</span> <span class=n>-Recursive</span>	
</span></span><span class=line><span class=cl><span class=nb>Get-ADGroupMember</span> <span class=n>-Identity</span> <span class=s2>&#34;Enterprise Admins&#34;</span> <span class=n>-Recursive</span>	
</span></span></code></pre></div><p>Get the group membership for a user:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetGroup</span> <span class=n>-UserName</span> <span class=s2>&#34;STUDENT1&#34;</span>	
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># ActiveDirectory Module</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ADPrincipalGroupMembership</span> <span class=n>-Identity</span> <span class=s2>&#34;STUDENT1&#34;</span>
</span></span></code></pre></div><p>Get local groups on localhost or an specified computer (need local admin rights on the target):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetLocalGroup</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetLocalGroup</span> <span class=n>-ComputerName</span> <span class=s2>&#34;COMPUTER1&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetLocalGroup</span> <span class=n>-ComputerName</span> <span class=s2>&#34;COMPUTER1&#34;</span> <span class=n>-ListGroups</span>	
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Get-NetLocalGroup</span> <span class=n>-ComputerName</span> <span class=s2>&#34;COMPUTER1&#34;</span> <span class=n>-GroupName</span> <span class=s2>&#34;Remote Desktop Users&#34;</span>	
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-batch data-lang=batch><span class=line><span class=cl><span class=p>:</span><span class=c1>: cmd.exe</span>
</span></span><span class=line><span class=cl>net localgroup
</span></span></code></pre></div><p>Get all effective local/domain users/groups that can access the machine with local administrative privileges:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetLocalGroup</span> <span class=n>-ComputerName</span> <span class=s2>&#34;COMPUTER1&#34;</span> <span class=n>-Recurse</span>	
</span></span></code></pre></div><p>Get currently logged users on a computer (need local admin rights on the target):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetLoggedon</span> <span class=n>-ComputerName</span> <span class=s2>&#34;COMPUTER1&#34;</span>
</span></span></code></pre></div><p>Get active sessions on the host:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetSession</span> <span class=n>-ComputerName</span> <span class=s2>&#34;COMPUTER1&#34;</span>
</span></span></code></pre></div><p>Get currently locally logged users on a computer (need remote registry - default in server OS):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Get-LoggedOnLocal</span>
</span></span><span class=line><span class=cl><span class=nb>Get-LoggedOnLocal</span> <span class=n>-ComputerName</span> <span class=s2>&#34;COMPUTER1&#34;</span>
</span></span></code></pre></div><p>Get the last logged user on a computer (need local admin rights on the target):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Get-LastLoggedOn</span> <span class=n>-ComputerName</span> <span class=s2>&#34;COMPUTER1&#34;</span>
</span></span></code></pre></div><p>List RDP sessions inside a computer (need local admin rights on the target):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetRDPSession</span> <span class=n>-ComputerName</span> <span class=s2>&#34;COMPUTER1&#34;</span>
</span></span></code></pre></div><p>Find shares on host in current domain:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-ShareFinder</span> <span class=n>-Verbose</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-ShareFinder</span> <span class=n>-ExcludeStandard</span> <span class=n>-ExcludePrint</span> <span class=n>-ExcludeIPC</span> <span class=n>-Verbose</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>## Check if the share is accessible</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-ShareFinder</span> <span class=n>-CheckShareAccess</span> <span class=n>-Verbose</span>
</span></span></code></pre></div><p>Find senstive files on computers in the domain:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-FileFinder</span> <span class=n>-Verbose</span>
</span></span></code></pre></div><p>Get all fileservers of the domain:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetFileServer</span>	
</span></span></code></pre></div><p>Get list of GPO in current domain:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetGPO</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetGPO</span> <span class=p>|</span> <span class=nb>select </span><span class=n>displayname</span><span class=p>,</span><span class=n>name</span><span class=p>,</span><span class=n>whencreated</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetGPO</span> <span class=n>-GPOname</span> <span class=s2>&#34;{AB306569-220D-43FF-B03B83E8F4EF8081}&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetGPO</span> <span class=n>-ComputerName</span> <span class=s2>&#34;COMPUTER1&#34;</span>
</span></span></code></pre></div><p>GPO files are stored in the SYSVOL path:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>cd </span><span class=s2>&#34;\\cyberlab.local\sysvol\cyberlab.local\Policies\{603ABE02-C554-49B1-A462-2FF89BC61CB2}&#34;</span>
</span></span></code></pre></div><p>and can be easily analized by using the tool <em>Registry.Pol Reader</em>. It is necessary to copy the folder to the local machine and then open the file <em>registry.pol</em> in the aforementioned tool. In case it is possible to install such tool on a machine in the analyzed domain, it can automatically capture and show all the policies.</p><p>Get GPO(s) which use Restricted Groups or groups.xml for interesting users:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetGPOGroup</span>
</span></span></code></pre></div><p>Get users/groups which are in a local group of a machine using GPO correlation (this command analyzes the GPO applied to the OU to which the computer belongs):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Find-GPOComputerAdmin</span> <span class=n>-ComputerName</span> <span class=s2>&#34;COMPUTER1.cyberlab.local&#34;</span>	<span class=c># Default group: Local Administrators</span>
</span></span><span class=line><span class=cl><span class=nb>Find-GPOComputerAdmin</span> <span class=n>-ComputerName</span> <span class=s2>&#34;COMPUTER1.cyberlab.local&#34;</span> <span class=n>-LocalGroup</span> <span class=s2>&#34;Remote Desktop Users&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>Find-GPOComputerAdmin</span> <span class=n>-ComputerName</span> <span class=s2>&#34;COMPUTER1.cyberlab.local&#34;</span> <span class=n>-Recurse</span> <span class=p>|</span> <span class=nb>select </span><span class=n>ComputerName</span><span class=p>,</span><span class=n>ObjectName</span><span class=p>,</span><span class=n>GPODisplayName</span><span class=p>,</span><span class=n>isGroup</span> <span class=p>|</span> <span class=nb>ft
</span></span></span><span class=line><span class=cl><span class=nb>Find-GPOComputerAdmin</span> <span class=n>-ComputerName</span> <span class=s2>&#34;COMPUTER1.cyberlab.local&#34;</span> <span class=n>-Recurse</span> <span class=p>|</span> <span class=p>?{</span><span class=nv>$_</span><span class=p>.</span><span class=py>IsGroup</span> <span class=o>-ne</span> <span class=vm>$true</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nb>Find-GPOComputerAdmin</span> <span class=n>-ComputerName</span> <span class=s2>&#34;COMPUTER1.cyberlab.local&#34;</span> <span class=n>-Recurse</span> <span class=p>|</span> <span class=p>?{</span><span class=nv>$_</span><span class=p>.</span><span class=py>IsGroup</span> <span class=o>-ne</span> <span class=vm>$true</span><span class=p>}</span> <span class=p>|</span> <span class=nb>select </span><span class=n>ComputerName</span><span class=p>,</span><span class=n>ObjectName</span><span class=p>,</span><span class=n>GPODisplayName</span> <span class=p>|</span> <span class=nb>ft
</span></span></span></code></pre></div><p>Get machines where the given user is member of a specific group using GPO correlation:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Find-GPOLocation</span> <span class=n>-UserName</span> <span class=s2>&#34;STUDENT1&#34;</span> <span class=n>-Domain</span> <span class=s2>&#34;cyberlab.local&#34;</span> <span class=n>-Verbose</span>	<span class=c># Default group: Local administrators</span>
</span></span><span class=line><span class=cl><span class=nb>Find-GPOLocation</span> <span class=n>-UserName</span> <span class=s2>&#34;STUDENT1&#34;</span> <span class=n>-Domain</span> <span class=s2>&#34;cyberlab.local&#34;</span> <span class=n>-LocalGroup</span> <span class=s2>&#34;Remote Desktop Users&#34;</span> <span class=n>-Verbose</span>
</span></span><span class=line><span class=cl><span class=nb>Find-GPOLocation</span> <span class=n>-UserName</span> <span class=s2>&#34;STUDENT1&#34;</span>  <span class=n>-Domain</span> <span class=s2>&#34;cyberlab.local&#34;</span> <span class=p>|</span> <span class=nb>select </span><span class=n>ComputerName</span>	
</span></span></code></pre></div><p>Get OUs in a domain:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetOU</span> <span class=n>-FullData</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetOU</span> <span class=n>-FullData</span> <span class=p>|</span> <span class=nb>select </span><span class=n>Name</span><span class=p>,</span><span class=n>gplink</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>## List all the computers in all OUs</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetOU</span> <span class=p>|</span> <span class=p>%{</span><span class=nb>echo </span><span class=nv>$_</span><span class=p>;</span> <span class=nb>Get-NetComputer</span> <span class=n>-ADSPath</span> <span class=nv>$_</span><span class=p>;</span> <span class=nb>echo </span><span class=s2>&#34;---&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>## List all the computers in an OU</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetOU</span> <span class=s2>&#34;*student*&#34;</span> <span class=p>|</span> <span class=p>%{</span><span class=nb>Get-NetComputer</span> <span class=n>-ADSPath</span> <span class=nv>$_</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>## Enumerate all GPOs applied to an OU</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetOU</span> <span class=p>*</span><span class=n>student</span><span class=p>*</span> <span class=p>|</span> <span class=p>%{</span><span class=nb>Get-NetComputer</span> <span class=n>-ADSPath</span> <span class=nv>$_</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetGPO</span> <span class=n>-ADSpath</span> <span class=s1>&#39;LDAP://cn={5BA02DB5-FC5E-4A57-A310-0B1600456CC7},cn=policies,cn=system,DC=cyberlab,DC=local&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># ActiveDirectory Module</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ADOrganizationalUnit</span> <span class=n>-Filter</span> <span class=p>*</span> <span class=n>-Properties</span> <span class=p>*</span>	
</span></span></code></pre></div><h2 id=access-control-lists-acl>Access Control Lists (ACL)</h2><p><strong>ACL Entities</strong></p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td>SID</td><td>Security IDentifier</td></tr><tr><td>DACL</td><td>Discretionary Access Control List</td></tr><tr><td>ACE</td><td>Access Control Entry (contained in DACL)</td></tr><tr><td>SACL</td><td>Security Access Control List (LOGS)</td></tr></tbody></table><hr><p><strong>ACE Structure</strong></p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td>IdentityReference</td><td>Subject</td></tr><tr><td>ActiveDirectoryRights</td><td>Privileges assigned to IdentityReference in relation to ObjectDN</td></tr><tr><td>ObjectDN</td><td>Target Object</td></tr></tbody></table><p><strong>IdentityReference</strong> can <strong>ActiveDirectoryRights</strong> on <strong>ObjectDN</strong></p><hr><p><strong>ActiveDirectoryRights</strong></p><table><thead><tr><th>Name</th><th>Value</th><th>Description</th></tr></thead><tbody><tr><td>AccessSystemSecurity</td><td>16777216</td><td>The right to get or set the SACL in the object security descriptor.</td></tr><tr><td>CreateChild</td><td>1</td><td>The right to create children of the object.</td></tr><tr><td>Delete</td><td>65536</td><td>The right to delete the object.</td></tr><tr><td>DeleteChild</td><td>2</td><td>The right to delete children of the object.</td></tr><tr><td>DeleteTree</td><td>64</td><td>The right to delete all children of this object, regardless of the permissions of the children.</td></tr><tr><td>ExtendedRight</td><td>256</td><td>A customized control access right. For a list of possible extended rights, see the topic &ldquo;Extended Rights&rdquo; in the MSDN Library at <a href=http://msdn.microsoft.com target=_blank rel=noopener>http://msdn.microsoft.com</a>. For more information about extended rights, see the topic &ldquo;Control Access Rights&rdquo; in the MSDN Library at <a href=http://msdn.microsoft.com target=_blank rel=noopener>http://msdn.microsoft.com</a>. [AllExtendedRights - ability to add user to a group or reset password]</td></tr><tr><td>ForceChangePassword</td><td></td><td>Ability to change user&rsquo;s password</td></tr><tr><td>GenericAll</td><td>983551</td><td>The right to create or delete children, delete a subtree, read and write properties, examine children and the object itself, add and remove the object from the directory, and read or write with an extended right. [full rights to the object (add users to a group or reset user&rsquo;s password)]</td></tr><tr><td>GenericExecute</td><td>131076</td><td>The right to read permissions on, and list the contents of, a container object.</td></tr><tr><td>GenericRead</td><td>131220</td><td>The right to read permissions on this object, read all the properties on this object, list this object name when the parent container is listed, and list the contents of this object if it is a container.</td></tr><tr><td>GenericWrite</td><td>131112</td><td>The right to read permissions on this object, write all the properties on this object, and perform all validated writes to this object. [update object&rsquo;s attributes (i.e logon script)]</td></tr><tr><td>ListChildren</td><td>4</td><td>The right to list children of this object. For more information about this right, see the topic &ldquo;Controlling Object Visibility&rdquo; in the MSDN Library <a href=http://msdn.microsoft.com/library target=_blank rel=noopener>http://msdn.microsoft.com/library</a>.</td></tr><tr><td>ListObject</td><td>128</td><td>The right to list a particular object. For more information about this right, see the topic &ldquo;Controlling Object Visibility&rdquo; in the MSDN Library at <a href=http://msdn.microsoft.com/library target=_blank rel=noopener>http://msdn.microsoft.com/library</a>.</td></tr><tr><td>ReadControl</td><td>131072</td><td>The right to read data from the security descriptor of the object, not including the data in the SACL.</td></tr><tr><td>ReadProperty</td><td>16</td><td>The right to read properties of the object.</td></tr><tr><td>Self</td><td>8</td><td>The right to perform an operation that is controlled by a validated write access right. [ability to add yourself to a group]</td></tr><tr><td>Synchronize</td><td>1048576</td><td>The right to use the object for synchronization. This right enables a thread to wait until that object is in the signaled state.</td></tr><tr><td>WriteDacl</td><td>262144</td><td>The right to modify the DACL in the object security descriptor. [modify object&rsquo;s ACEs and give attacker full control right over the object]</td></tr><tr><td>WriteOwner</td><td>524288</td><td>The right to assume ownership of the object. The user must be an object trustee. The user cannot transfer the ownership to other users. [change object owner to attacker controlled user take over the object]</td></tr><tr><td>WriteProperty</td><td>32</td><td>The right to write properties of the object.</td></tr></tbody></table><p>Get the ACLs associated with the specified SamAccountName (ObjectDN - Target object):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView					</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ObjectAcl</span> <span class=n>-SamAccountName</span> <span class=s2>&#34;STUDENT1&#34;</span> <span class=n>-ResolveGUIDs</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ObjectAcl</span> <span class=n>-SamAccountName</span> <span class=s2>&#34;STUDENT1&#34;</span> <span class=n>-ResolveGUIDs</span> <span class=p>|</span> <span class=nb>select </span><span class=n>IdentityReference</span><span class=p>,</span><span class=n>ActiveDirectoryRights</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ObjectAcl</span> <span class=n>-SamAccountName</span> <span class=s2>&#34;STUDENT1&#34;</span> <span class=n>-ResolveGUIDs</span> <span class=p>|</span> <span class=p>?</span> <span class=p>{</span><span class=nv>$_</span><span class=p>.</span><span class=py>ActiveDirectoryRights</span> <span class=o>-eq</span> <span class=s2>&#34;GenericAll&#34;</span><span class=p>}</span>	
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Get-ObjectAcl</span> <span class=n>-SamAccountName</span> <span class=s2>&#34;Domain Admins&#34;</span> <span class=n>-ResolveGUIDs</span>
</span></span></code></pre></div><p>Get the ACLs associated with the specified target AD prefix or path (ObjectDN - Target object):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView	</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ObjectAcl</span> <span class=n>-ADSprefix</span> <span class=s2>&#34;CN=Administrator,CN=Users&#34;</span> <span class=n>-Verbose</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ObjectAcl</span> <span class=n>-ADSprefix</span> <span class=s2>&#34;CN=FirstName LastName,CN=Users&#34;</span> <span class=n>-Verbose</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ObjectAcl</span> <span class=n>-ADSpath</span> <span class=s2>&#34;CN=FirstName LastName,CN=Users,DC=cyberlab,DC=cybercorp,DC=local&#34;</span> <span class=n>-Verbose</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># ActiveDirectory Module</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=nb>Get-Acl</span> <span class=s2>&#34;AD:\CN=Administrator,CN=Users,DC=cyberlab,DC=cybercorp,DC=local&#34;</span><span class=p>).</span><span class=py>Access</span>	
</span></span></code></pre></div><p>Get the ACLs associated with the specified target LDAP path (ObjectDN - Target object):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ObjectAcl</span> <span class=n>-ADSpath</span> <span class=s2>&#34;LDAP://CN=Domain Admins,CN=Users,DC=cyberlab,DC=cybercorp,DC=local&#34;</span> <span class=n>-ResolveGUIDs</span> <span class=n>-Verbose</span>
</span></span></code></pre></div><p>Get the ACLs associated to all the GPOs:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetGPO</span> <span class=p>|</span> <span class=p>%{</span><span class=nb>Get-ObjectAcl</span> <span class=n>-ResolveGUIDs</span> <span class=n>-Name</span> <span class=nv>$_</span><span class=p>.</span><span class=n>Name</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>## Enumerate those GPOs where a particular user has interesting permissions</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetGPO</span> <span class=p>|</span> <span class=p>%{</span><span class=nb>Get-ObjectAcl</span> <span class=n>-ResolveGUIDs</span> <span class=n>-Name</span> <span class=nv>$_</span><span class=p>.</span><span class=n>Name</span><span class=p>}</span> <span class=p>|</span> <span class=p>?{</span><span class=nv>$_</span><span class=p>.</span><span class=py>IdentityReference</span> <span class=o>-match</span> <span class=s2>&#34;STUDENT1&#34;</span><span class=p>}</span>
</span></span></code></pre></div><p>Search for interesting ACEs:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-ACLScanner</span> <span class=n>-ResolveGUIDs</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-ACLScanner</span> <span class=n>-ResolveGUIDs</span> <span class=p>|</span> <span class=nb>ft
</span></span></span><span class=line><span class=cl><span class=nb>Invoke-ACLScanner</span> <span class=n>-ResolveGUIDs</span> <span class=p>|</span> <span class=nb>select </span><span class=n>IdentityReference</span><span class=p>,</span><span class=n>ActiveDirectoryRights</span><span class=p>,</span><span class=n>ObjectDN</span> <span class=p>|</span> <span class=nb>ft
</span></span></span><span class=line><span class=cl><span class=nb>Invoke-ACLScanner</span> <span class=n>-ResolveGUIDs</span> <span class=p>|</span> <span class=p>?</span> <span class=p>{</span><span class=nv>$_</span><span class=p>.</span><span class=py>ActiveDirectoryRights</span> <span class=o>-eq</span> <span class=s2>&#34;GenericAll&#34;</span><span class=p>}</span> <span class=p>|</span> <span class=nb>select </span><span class=n>IdentityReference</span><span class=p>,</span><span class=n>ActiveDirectoryRights</span><span class=p>,</span><span class=n>ObjectDN</span> <span class=p>|</span> <span class=nb>ft
</span></span></span><span class=line><span class=cl><span class=nb></span>
</span></span><span class=line><span class=cl><span class=c>## Check if a particular user has interesting permissions</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-ACLScanner</span> <span class=n>-ResolveGUIDs</span> <span class=p>|</span> <span class=p>?{</span><span class=nv>$_</span><span class=p>.</span><span class=py>IdentityReference</span> <span class=o>-match</span> <span class=s2>&#34;STUDENT1&#34;</span><span class=p>}</span>
</span></span></code></pre></div><p>Get the ACLs associated with the specified file path:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Get-PathAcl</span> <span class=n>-Path</span> <span class=s2>&#34;\\cyberlab-dc.cyberlab.cybercorp.local\SYSVOL&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>Get-PathAcl</span> <span class=n>-Path</span> <span class=s2>&#34;\\COMPUTER1.cyberlab.cybercorp.local\C$&#34;</span>
</span></span></code></pre></div><h2 id=trusts-and-forests>Trusts and Forests</h2><p><strong>Trust directions</strong></p><table><thead><tr><th>Direction</th><th>Description</th></tr></thead><tbody><tr><td>Bidirectional</td><td>Two-way</td></tr><tr><td>Unidirectional</td><td>One-way</td></tr></tbody></table><hr><p><strong>Trust transitivity</strong></p><table><thead><tr><th>Transitivity</th><th>Description</th></tr></thead><tbody><tr><td>Transitive</td><td>Can be extended to other domains in the forest</td></tr><tr><td>Nontransititve</td><td>Cannot be extended to other domains in the forest</td></tr></tbody></table><hr><p><strong>Trust Type</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>Parent-child</td><td>Automatic</td><td>Automatically created between the new domain and the domain that precedes it in the namespace hierarchy whenever a new domain is added to a tree (always two-way transitive)</td></tr><tr><td>Tree-root</td><td>Automatic</td><td>Automatically created whenever a new domain tree is added to a forest root (always two-way transitive)</td></tr><tr><td>External</td><td>Established</td><td>Two domains in different forests when forests do not have a trust relationship (one-way or two-way and nontransitive)</td></tr><tr><td>Shortcut</td><td>Established</td><td>Used to reduce access times in complex trust scenarios (one-way or two-way)</td></tr><tr><td>Forest</td><td>Established</td><td>Between forest root domains (one-way or two-way and transitive, if specified, or nontransitive)</td></tr></tbody></table><hr><p>Get a list of all domain trusts for the current or a trusted domain:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetDomainTrust</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetDomainTrust</span> <span class=n>-Domain</span> <span class=s2>&#34;cybercorp.local&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># ActiveDirectory Module</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ADTrust</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ADTrust</span> <span class=n>-Filter</span> <span class=s1>&#39;msDS-TrustForestTrustInfo -ne &#34;$null&#34;&#39;</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ADTrust</span> <span class=n>-Identity</span> <span class=s2>&#34;cybercorp.local&#34;</span> 
</span></span></code></pre></div><p>Get detail about the current or a trusted forest:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetForest</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetForest</span> <span class=n>-Forest</span> <span class=s2>&#34;evilcorp.local&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># ActiveDirectory Module</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ADForest</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ADForest</span> <span class=n>-Identity</span> <span class=s2>&#34;evilcorp.local&#34;</span>
</span></span></code></pre></div><p>Get all domains in the current or in a trusted forest:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetForestDomain</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetForestDomain</span> <span class=n>-Forest</span> <span class=s2>&#34;evilcorp.local&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># ActiveDirectory Module</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=nb>Get-ADForest</span><span class=p>).</span><span class=py>Domains</span>
</span></span></code></pre></div><p>Get all global catalogs for the current or a trusted forest:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetForestCatalog</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetForestCatalog</span> <span class=n>-Forest</span> <span class=s2>&#34;evilcorp.local&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># ActiveDirectory Module</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ADForest</span> <span class=p>|</span> <span class=nb>select </span><span class=n>-ExpandProperty</span> <span class=n>GlobalCatalogs</span>	
</span></span></code></pre></div><p>Map trusts of a forest:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetForestTrust</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetForestTrust</span> <span class=n>-Forest</span> <span class=s2>&#34;evilcorp.local&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># ActiveDirectory Module</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ADTrust</span> <span class=n>-Filter</span> <span class=s1>&#39;msDS-TrustForestTrustInfo -ne &#34;$null&#34;&#39;</span>	
</span></span></code></pre></div><p>Map all the trusts of the domains in the current or in a trusted forest:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetForestDomain</span> <span class=n>-Verbose</span> <span class=p>|</span> <span class=nb>Get-NetDomainTrust</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetForestDomain</span> <span class=n>-Forest</span> <span class=s2>&#34;evilcorp.local&#34;</span> <span class=n>-Verbose</span> <span class=p>|</span> <span class=nb>Get-NetDomainTrust</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>## List only external trusts</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetForestDomain</span> <span class=n>-Verbose</span> <span class=p>|</span> <span class=nb>Get-NetDomainTrust</span> <span class=p>|</span> <span class=p>?{</span><span class=nv>$_</span><span class=p>.</span><span class=py>TrustType</span> <span class=o>-eq</span> <span class=s1>&#39;External&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>## List all trusts of a trusting forest</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetForestDomain</span> <span class=n>-Forest</span> <span class=s2>&#34;evilcorp.local&#34;</span> <span class=n>-Verbose</span> <span class=p>|</span> <span class=n>GetNetDomainTrust</span>
</span></span></code></pre></div><p>Try to build a relational mapping of all domain trusts:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-MapDomainTrust</span>
</span></span></code></pre></div><h2 id=user-hunting>User Hunting</h2><p>Find all machines on the current/trusted domain where the current user has local admin access:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Find-LocalAdminAccess</span> <span class=n>-Verbose</span>
</span></span><span class=line><span class=cl><span class=nb>Find-LocalAdminAccess</span> <span class=n>-Verbose</span> <span class=n>-NoPing</span>
</span></span><span class=line><span class=cl><span class=nb>Find-LocalAdminAccess</span> <span class=n>-Domain</span> <span class=s2>&#34;cybercorp.local&#34;</span> <span class=n>-Verbose</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Find-WMILocalAdminAccess.ps1</span>
</span></span><span class=line><span class=cl><span class=nb>Find-WMILocalAdminAccess</span> <span class=n>-Verbose</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Get-NetComputer</span> <span class=n>-Domain</span> <span class=n>cyberlab</span><span class=p>.</span><span class=py>local</span> <span class=p>&gt;</span> <span class=p>.\</span><span class=n>targets</span><span class=p>.</span><span class=py>txt</span>
</span></span><span class=line><span class=cl><span class=nb>Find-WMILocalAdminAccess</span> <span class=n>-ComputerFile</span> <span class=p>.\</span><span class=n>targets</span><span class=p>.</span><span class=py>txt</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Find-PSRemotingLocalAdminAccess.ps1</span>
</span></span><span class=line><span class=cl><span class=nb>Find-PSRemotingLocalAdminAccess</span> <span class=n>-Verbose</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Get-NetComputer</span> <span class=n>-Domain</span> <span class=n>cyberlab</span><span class=p>.</span><span class=py>local</span> <span class=p>&gt;</span> <span class=p>.\</span><span class=n>targets</span><span class=p>.</span><span class=py>txt</span>
</span></span><span class=line><span class=cl><span class=nb>Find-PSRemotingLocalAdminAccess</span> <span class=n>-ComputerFile</span> <span class=p>.\</span><span class=n>targets</span><span class=p>.</span><span class=py>txt</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Find-PSRemotingLocalAdminAccessCreds.ps1</span>
</span></span><span class=line><span class=cl><span class=nb>Find-PSRemotingLocalAdminAccessCreds</span> <span class=n>-Username</span> <span class=s2>&#34;STUDENT01&#34;</span> <span class=n>-Password</span> <span class=s2>&#34;Password123.&#34;</span> <span class=n>-Verbose</span>
</span></span></code></pre></div><p>Find local admins on all machines of the domain (needs administrator privs on non-dc machines):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-EnumerateLocalAdmin</span> <span class=n>-Verbose</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-EnumerateLocalAdmin</span> <span class=n>-Verbose</span> <span class=n>-NoPing</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-EnumerateLocalAdmin</span> <span class=p>|</span> <span class=nb>select </span><span class=n>ComputerName</span><span class=p>,</span><span class=n>AccountName</span><span class=p>,</span><span class=n>IsGroup</span> <span class=p>|</span> <span class=nb>ft
</span></span></span></code></pre></div><p>Find computers where a domain admin (or specific user/group) has sessions:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-UserHunter</span> 	<span class=c># Domain Admins</span>
</span></span><span class=line><span class=cl><span class=nb>invoke-UserHunter</span>  <span class=p>|</span> <span class=nb>select </span><span class=n>UserDomain</span><span class=p>,</span><span class=n>UserName</span><span class=p>,</span><span class=n>ComputerName</span><span class=p>,</span><span class=n>SessionFromName</span> <span class=p>|</span> <span class=nb>ft
</span></span></span><span class=line><span class=cl><span class=nb>Invoke-UserHunter</span> <span class=n>-GroupName</span> <span class=s2>&#34;Remote Desktop Users&#34;</span>	<span class=c># Specific group</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-UserHunter</span> <span class=n>-Domain</span> <span class=s2>&#34;cyberlab.local&#34;</span> <span class=n>-UserName</span> <span class=s2>&#34;STUDENT1&#34;</span> <span class=c># Specific user</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Invoke-UserHunter</span> <span class=n>-ComputerName</span> <span class=s2>&#34;COMPUTER01&#34;</span> <span class=n>-Poll</span> <span class=mf>100</span> <span class=n>-UserName</span> <span class=s2>&#34;Administrator&#34;</span> <span class=n>-Delay</span> <span class=mf>5</span> <span class=n>-Verbose</span>
</span></span></code></pre></div><p>Find computers where a domain admin is logged into and checks if the local user has local administrator access:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-UserHunter</span> <span class=n>-CheckAccess</span>	
</span></span></code></pre></div><p>Find computers where a domain admin is logged-in without sending queries to DCs:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-UserHunter</span> <span class=n>-Stealth</span>	
</span></span></code></pre></div><h2 id=bloodhound>Bloodhound</h2><p>Commands to be run on a Linux machine to run Bloodhound analyzer:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>apt-get install bloodhound
</span></span><span class=line><span class=cl>neo4j console
</span></span><span class=line><span class=cl>bloodhound
</span></span></code></pre></div><p>Commands to be run on a domain machine to analyze the domain:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.</span>  <span class=p>.\</span><span class=n>SharpHound</span><span class=p>.</span><span class=py>ps1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>## Gather data and information about the current domain</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-BloodHound</span> <span class=n>-CollectionMethod</span> <span class=n>All</span> <span class=n>-Verbose</span> <span class=n>-JSONFolder</span> <span class=s2>&#34;c:\experiments\bloodhound&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-BloodHound</span> <span class=n>-CollectionMethod</span> <span class=n>All</span> <span class=n>-ExcludeDC</span> <span class=n>-Verbose</span> <span class=n>-JSONFolder</span> <span class=s2>&#34;c:\experiments\bloodhound&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>## Gather information about established sessions</span>
</span></span><span class=line><span class=cl><span class=n>InvokeBloodHound</span> <span class=n>-CollectionMethod</span> <span class=n>LoggedOn</span> <span class=n>-Verbose</span>
</span></span></code></pre></div><h2 id=full-enumeration-sequence>Full Enumeration Sequence</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.</span> <span class=p>.\</span><span class=n>PowerView</span><span class=p>.</span><span class=py>ps1</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetDomain</span>
</span></span><span class=line><span class=cl><span class=nb>Get-DomainSid</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetForest</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetForestDomain</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetForestDomain</span> <span class=p>|</span> <span class=nb>Get-NetDomainTrust</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetForestTrust</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-MapDomainTrust</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Execute domain analysis for all domain of interest</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetDomain</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=nb>gwmi </span><span class=n>Win32_NTDomain</span><span class=p>).</span><span class=py>DomainName</span>
</span></span><span class=line><span class=cl><span class=nb>Get-DomainSid</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetDomainController</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetComputer</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetComputer</span> <span class=n>-FullData</span> <span class=p>|</span> <span class=nb>select </span><span class=n>name</span><span class=p>,</span><span class=n>operatingsystem</span><span class=p>,</span><span class=n>description</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetComputer</span> <span class=p>|</span> <span class=p>%</span> <span class=p>{</span><span class=nv>$name</span><span class=p>=</span><span class=nv>$_</span><span class=p>;</span> <span class=nv>$ip</span><span class=p>=[</span><span class=no>System.Net.Dns</span><span class=p>]::</span><span class=n>GetHostAddresses</span><span class=p>(</span><span class=nv>$name</span><span class=p>).</span><span class=n>IPAddressToString</span><span class=p>;</span> <span class=nb>Write-Host</span> <span class=nv>$name</span> <span class=s2>&#34;</span><span class=se>`t</span><span class=s2> : &#34;</span> <span class=nv>$ip</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetOU</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetOU</span> <span class=p>|</span> <span class=p>%{</span><span class=nb>echo </span><span class=nv>$_</span><span class=p>;</span> <span class=nb>Get-NetComputer</span> <span class=n>-ADSPath</span> <span class=nv>$_</span><span class=p>;</span> <span class=nb>echo </span><span class=s2>&#34;---&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetUser</span> <span class=p>|</span> <span class=nb>select </span><span class=n>name</span><span class=p>,</span><span class=n>samaccountname</span><span class=p>,</span><span class=n>description</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetUser</span> <span class=p>|</span> <span class=nb>where </span><span class=p>{</span><span class=nv>$_</span><span class=p>.</span><span class=n>mail</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nb>Find-UserField</span> <span class=n>-Verbose</span>
</span></span><span class=line><span class=cl><span class=nb>Find-ComputerField</span> <span class=n>-SearchField</span> <span class=s2>&#34;OperatingSystem&#34;</span> <span class=n>-SearchTerm</span> <span class=s2>&#34;windows&#34;</span>	
</span></span><span class=line><span class=cl><span class=nb>Get-NetGroup</span> <span class=n>-GroupName</span> <span class=s2>&#34;Domain Admins&#34;</span> <span class=n>-FullData</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetGroupMember</span> <span class=n>-GroupName</span> <span class=s2>&#34;Domain Admins&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetGroup</span> <span class=n>-GroupName</span> <span class=s2>&#34;Enterprise Admins&#34;</span> <span class=n>-FullData</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetGroupMember</span> <span class=n>-GroupName</span> <span class=s2>&#34;Enterprise Admins&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetGPO</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetGPOGroup</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetFileServer</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-ShareFinder</span> <span class=n>-ExcludeStandard</span> <span class=n>-ExcludeIPC</span> <span class=n>-ExcludePrint</span> <span class=n>-CheckShareAccess</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-ACLScanner</span> <span class=n>-ResolveGUIDs</span> <span class=p>|</span> <span class=nb>select </span><span class=n>IdentityReference</span><span class=p>,</span><span class=n>ActiveDirectoryRights</span><span class=p>,</span><span class=n>ObjectDN</span> <span class=p>|</span> <span class=nb>ft
</span></span></span><span class=line><span class=cl><span class=nb></span>
</span></span><span class=line><span class=cl><span class=c># Start to move laterally/escalate privileges</span>
</span></span><span class=line><span class=cl><span class=nb>Find-LocalAdminAccess</span> <span class=n>-Verbose</span> <span class=n>-NoPing</span>
</span></span><span class=line><span class=cl><span class=nb>Find-WMILocalAdminAccess</span> <span class=n>-Verbose</span>
</span></span><span class=line><span class=cl><span class=nb>Find-PSRemotingLocalAdminAccess</span> <span class=n>-Verbose</span>
</span></span><span class=line><span class=cl><span class=nb>Find-PSRemotingLocalAdminAccessCreds</span> <span class=n>-Username</span> <span class=s2>&#34;STUDENT01&#34;</span> <span class=n>-Password</span> <span class=s2>&#34;Password123.&#34;</span> <span class=n>-Verbose</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># User Hunting (default: Domain Admins)</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-UserHunter</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-UserHunter</span> <span class=n>-CheckAccess</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Port Scanning (PowerSploit)</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-Portscan</span> <span class=n>-Hosts</span> <span class=vm>@</span><span class=p>(</span><span class=nb>Get-NetComputer</span><span class=p>)</span> <span class=n>-TopPorts</span> <span class=mf>100</span> <span class=p>|</span> <span class=p>%{</span><span class=nb>echo </span><span class=nv>$_</span><span class=p>.</span><span class=n>Hostname</span><span class=p>;</span> <span class=nb>echo </span><span class=s2>&#34;--- OPEN ---&#34;</span><span class=p>;</span> <span class=nb>echo </span><span class=nv>$_</span><span class=p>.</span><span class=n>openPorts</span><span class=p>;</span> <span class=nb>echo </span><span class=s2>&#34;------------&#34;</span><span class=p>;</span> <span class=nb>echo </span><span class=s2>&#34;&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Privilege Escalation</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetUser</span> <span class=n>-SPN</span> <span class=c># Kerberoasting</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetComputer</span> <span class=n>-Unconstrained</span> <span class=c># Unconstrained delegation</span>
</span></span><span class=line><span class=cl><span class=nb>Get-DomainUser</span> <span class=n>-PreauthNotRequired</span> <span class=n>-Verbose</span> <span class=c># ASREPRoasting (PowerView_dev)</span>
</span></span><span class=line><span class=cl><span class=nb>Get-DomainUser</span> <span class=n>-TrustedToAuth</span> <span class=c># Constrained delegation (user)</span>
</span></span><span class=line><span class=cl><span class=nb>Get-DomainComputer</span> <span class=n>-TrustedToAuth</span> <span class=c># Constrained delegation (computer)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Look for interesting MSSQL instance</span>
</span></span><span class=line><span class=cl><span class=nb>Import-Module</span> <span class=p>.\</span><span class=n>PowerUpSQL</span><span class=p>.</span><span class=py>psd1</span>
</span></span><span class=line><span class=cl><span class=nb>Get-SQLInstanceDomain</span>
</span></span><span class=line><span class=cl><span class=nb>Get-SQLInstanceDomain</span> <span class=p>|</span> <span class=nb>Get-SQLConnectionTestThreaded</span> <span class=n>-Verbose</span>
</span></span><span class=line><span class=cl><span class=nb>Get-SQLInstanceDomain</span> <span class=p>|</span> <span class=nb>Get-SQLServerInfoThreaded</span> <span class=n>-Verbose</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-SQLAudit</span> <span class=n>-Verbose</span> <span class=n>-Instance</span> <span class=s2>&#34;SQLServer1\Instance1&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-SQLEscalatePriv</span> <span class=n>-Verbose</span> <span class=n>-Instance</span> <span class=s2>&#34;SQLServer1\Instance1&#34;</span>
</span></span></code></pre></div><hr></div><div class=article-tags><a class="badge badge-light" href=/tag/cheatsheet/>Cheatsheet</a>
<a class="badge badge-light" href=/tag/red-teaming/>Red Teaming</a>
<a class="badge badge-light" href=/tag/windows/>Windows</a>
<a class="badge badge-light" href=/tag/active-directory/>Active Directory</a>
<a class="badge badge-light" href=/tag/enumeration/>Enumeration</a></div><div class=share-box><ul class=share><li><a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fwww.peco602.com%2Fpost%2F0000-domain-enumeration-cheatsheet%2F&text=Domain+Enumeration+cheatsheet" target=_blank rel=noopener class=share-btn-twitter aria-label=twitter><i class="fab fa-twitter"></i></a></li><li><a href="https://www.facebook.com/sharer.php?u=https%3A%2F%2Fwww.peco602.com%2Fpost%2F0000-domain-enumeration-cheatsheet%2F&t=Domain+Enumeration+cheatsheet" target=_blank rel=noopener class=share-btn-facebook aria-label=facebook><i class="fab fa-facebook"></i></a></li><li><a href="mailto:?subject=Domain%20Enumeration%20cheatsheet&body=https%3A%2F%2Fwww.peco602.com%2Fpost%2F0000-domain-enumeration-cheatsheet%2F" target=_blank rel=noopener class=share-btn-email aria-label=envelope><i class="fas fa-envelope"></i></a></li><li><a href="https://www.linkedin.com/shareArticle?url=https%3A%2F%2Fwww.peco602.com%2Fpost%2F0000-domain-enumeration-cheatsheet%2F&title=Domain+Enumeration+cheatsheet" target=_blank rel=noopener class=share-btn-linkedin aria-label=linkedin-in><i class="fab fa-linkedin-in"></i></a></li><li><a href="whatsapp://send?text=Domain+Enumeration+cheatsheet%20https%3A%2F%2Fwww.peco602.com%2Fpost%2F0000-domain-enumeration-cheatsheet%2F" target=_blank rel=noopener class=share-btn-whatsapp aria-label=whatsapp><i class="fab fa-whatsapp"></i></a></li><li><a href="https://service.weibo.com/share/share.php?url=https%3A%2F%2Fwww.peco602.com%2Fpost%2F0000-domain-enumeration-cheatsheet%2F&title=Domain+Enumeration+cheatsheet" target=_blank rel=noopener class=share-btn-weibo aria-label=weibo><i class="fab fa-weibo"></i></a></li></ul></div><div class="media author-card content-widget-hr"><a href=https://www.peco602.com/><img class="avatar mr-3 avatar-circle" src=/authors/admin/avatar_huf4f2a9d771509e6e0b947acc7d389632_627121_270x270_fill_q75_lanczos_center.jpg alt="Giovanni Pecoraro"></a><div class=media-body><h5 class=card-title><a href=https://www.peco602.com/>Giovanni Pecoraro</a></h5><h6 class=card-subtitle>Senior Security Engineer</h6><p class=card-text>My research interests include space systems, cyber security, signal processing and artificial intelligence.</p><ul class=network-icon aria-hidden=true><li><a href=/#contact><i class="fas fa-envelope"></i></a></li><li><a href=https://twitter.com/Peco602 target=_blank rel=noopener><i class="fab fa-twitter"></i></a></li><li><a href="https://scholar.google.com/citations?user=JSM2EcoAAAAJ" target=_blank rel=noopener><i class="ai ai-google-scholar"></i></a></li><li><a href=https://www.researchgate.net/profile/Giovanni-Pecoraro target=_blank rel=noopener><i class="fab fa-researchgate"></i></a></li><li><a href=https://github.com/Peco602 target=_blank rel=noopener><i class="fab fa-github"></i></a></li><li><a href=https://it.linkedin.com/in/giovanni-pecoraro-078500155 target=_blank rel=noopener><i class="fab fa-linkedin"></i></a></li><li><a href=/uploads/resume.pdf><i class="ai ai-cv"></i></a></li></ul></div></div><script src=https://utteranc.es/client.js repo=Peco602/peco602.github.io issue-term=pathname label=comment theme=github-light crossorigin=anonymous async></script></div></article></div><div class=page-footer><div class=container><footer class=site-footer><p class="powered-by copyright-license-text">© 2023 Me. This work is licensed under <a href=https://creativecommons.org/licenses/by-nc-nd/4.0 rel="noopener noreferrer" target=_blank>CC BY NC ND 4.0</a></p><p class="powered-by footer-license-icons"><a href=https://creativecommons.org/licenses/by-nc-nd/4.0 rel="noopener noreferrer" target=_blank aria-label="Creative Commons"><i class="fab fa-creative-commons fa-2x" aria-hidden=true></i>
<i class="fab fa-creative-commons-by fa-2x" aria-hidden=true></i>
<i class="fab fa-creative-commons-nc fa-2x" aria-hidden=true></i>
<i class="fab fa-creative-commons-nd fa-2x" aria-hidden=true></i></a></p><p class=powered-by>Published with <a href="https://wowchemy.com/?utm_campaign=poweredby" target=_blank rel=noopener>Wowchemy</a> — the free, <a href=https://github.com/wowchemy/wowchemy-hugo-themes target=_blank rel=noopener>open source</a> website builder that empowers creators.</p></footer></div></div><script src=/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js></script>
<script id=search-hit-fuse-template type=text/x-template>
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script><script src=https://cdn.jsdelivr.net/gh/krisk/Fuse@v3.2.1/dist/fuse.min.js integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/gh/julmot/mark.js@8.11.1/dist/jquery.mark.min.js integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin=anonymous></script>
<script id=page-data type=application/json>{"use_headroom":true}</script><script src=/js/wowchemy-headroom.db4755770454eb63685f8de785c0a172.js type=module></script>
<script src=/en/js/wowchemy.min.e8ee06ba8371980ffde659871dd593b0.js></script><div id=modal class="modal fade" role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><h5 class=modal-title>Cite</h5><button type=button class=close data-dismiss=modal aria-label=Close>
<span aria-hidden=true>&#215;</span></button></div><div class=modal-body><pre><code></code></pre></div><div class=modal-footer><a class="btn btn-outline-primary my-1 js-copy-cite" href=# target=_blank><i class="fas fa-copy"></i> Copy</a>
<a class="btn btn-outline-primary my-1 js-download-cite" href=# target=_blank><i class="fas fa-download"></i> Download</a><div id=modal-error></div></div></div></div></div><script src=/js/wowchemy-publication.68f8d7090562ca65fc6d3cb3f8f2d2cb.js type=module></script></body></html>